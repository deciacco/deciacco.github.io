<!doctype html>
<html lang="en-us">
  <head>
    <title>Comcast Modem Power Level Monitor // deciacco</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.102.3" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="eugenio c." />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://deciacco.github.io/css/main.min.5316ee9d244c43259d1edf71732df146afe7bfd40379385ea68d107a1a635f03.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Comcast Modem Power Level Monitor"/>
<meta name="twitter:description" content="Below you&rsquo;ll find scripts to monitor a Comcast modem&rsquo;s power levels to help troubleshoot line problems.
The power of this tool becomes apparent when you use the data gathered to maintain an event journal of everything that happens related to your connection.
For example, for my business, everytime I show packet loss in my firewall I can corelate it to abnormal power levels in the modem. This is critical, not only to know that the problem lies outside of my control, but also to aide the Comcast technitians in fixing the issue."/>

    <meta property="og:title" content="Comcast Modem Power Level Monitor" />
<meta property="og:description" content="Below you&rsquo;ll find scripts to monitor a Comcast modem&rsquo;s power levels to help troubleshoot line problems.
The power of this tool becomes apparent when you use the data gathered to maintain an event journal of everything that happens related to your connection.
For example, for my business, everytime I show packet loss in my firewall I can corelate it to abnormal power levels in the modem. This is critical, not only to know that the problem lies outside of my control, but also to aide the Comcast technitians in fixing the issue." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://deciacco.github.io/posts/comcastmodemmonitor/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-11-19T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-11-19T00:00:00+00:00" />



  </head>
  <body>
    <header class="app-header">
      <h1><a href="https://deciacco.github.io">eugenio c.</a></h1>
      <p class="site-description">my stuff online</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/deciacco" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
      </div>
      <nav >
        
        <ul class="sidebar-nav">
        
          <li><a class="sidebar-nav-item" href="/posts/" title="blog section">Posts</a></li>
        
          <li><a class="sidebar-nav-item" href="/tags/" title="tags section">Tags</a></li>
        
        </ul>
      </nav>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Comcast Modem Power Level Monitor</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Nov 19, 2019
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          12 min read
        </div><div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://deciacco.github.io/tags/python/">Python</a><a class="tag" href="https://deciacco.github.io/tags/r/">R</a></div></div>
    </header>
    <div class="post-content">
      <p>Below you&rsquo;ll find scripts to monitor a Comcast modem&rsquo;s power levels to help troubleshoot line problems.</p>
<p>The power of this tool becomes apparent when you use the data gathered to maintain an event journal of everything that happens related to your connection.</p>
<p>For example, for my business, everytime I show packet loss in my firewall I can corelate it to abnormal power levels in the modem. This is critical, not only to know that the problem lies outside of my control, but also to aide the Comcast technitians in fixing the issue. The graphs are especially usefull to show connection issues over time.</p>
<h2 id="windows-subsystem-for-linux">Windows Subsystem for Linux</h2>
<p>Built-in linux system in Windows 10. You can run these scripts on any linux based system, but this was readily available and already on our existing network.</p>
<h3 id="start-cron--ssh-at-windows-startup">Start Cron &amp; SSH at Windows Startup</h3>
<p>Short batch file <code>startup.bat</code> used by a scheduled task in Windows to start the ssh and cron daemons in WSL. This is useful in case the host comptuer is restarted. (Windows Updates restarts mainly&hellip;)</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-batch" data-lang="batch"><span style="display:flex;"><span>@<span style="color:#6ab825;font-weight:bold">echo</span> off
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>wsl -u root service ssh start
</span></span><span style="display:flex;"><span>wsl -u root service cron start
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">exit</span>
</span></span></code></pre></div><h3 id="ssh">SSH</h3>
<p>Having SSH installed in WSL makes it a lot easier to connect in and work on the script, check logs, etc.</p>
<h3 id="cron">Cron</h3>
<ul>
<li>Run the graph generating script every hour.</li>
<li>At 1 min intervals, check the python script hasn&rsquo;t errored out. If it&rsquo;s not running, start it.</li>
</ul>
<pre tabindex="0"><code>0 * * * * /home/user/scripts/comcast/cm_run.sh
*/1 * * * * /home/user/scripts/comcast/keep_alive.sh
</code></pre><h3 id="cm_rushsh">cm_rush.sh</h3>
<p>Simple script to run the graph generating code. Could run R script directly from cron, but this allows other scripts to be called if needed.</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#cd2828;font-weight:bold">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#cd2828;font-weight:bold"></span>
</span></span><span style="display:flex;"><span>~/scripts/comcast/comcastplot.R
</span></span></code></pre></div><h3 id="keep_alivesh">keep_alive.sh</h3>
<p>Script to check if the python code is running. If it isn&rsquo;t, it will restart it.</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#cd2828;font-weight:bold">#!/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#cd2828;font-weight:bold"></span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">if</span> ! pgrep -f <span style="color:#ed9d13">&#39;cmpwrlevel2.py&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">then</span>
</span></span><span style="display:flex;"><span>    nohup <span style="color:#6ab825;font-weight:bold">$(</span>which python3<span style="color:#6ab825;font-weight:bold">)</span> ~/scripts/comcast/cmpwrlevel2.py &amp;
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">fi</span>
</span></span></code></pre></div><h2 id="modem-power-levels">Modem Power Levels</h2>
<p>Poll the modem every minute and log the upstream (U) and downstream (D) powerlevels.</p>
<p>Acceptable ranges: (Note the DOCSIS 3.1, which is neede for higher speeds has lower tolerances.) <a href="https://www.dslreports.com/faq/16085" target="_blank"><a href="https://www.dslreports.com/faq/16085">https://www.dslreports.com/faq/16085</a></a></p>
<h3 id="sample-data">Sample Data</h3>
<pre tabindex="0"><code>2019-09-16 01:30:17 U 43.78 dBmV D 3.97 dBmV
2019-09-16 01:31:18 U 43.78 dBmV D 3.97 dBmV
2019-09-16 01:32:18 U 43.78 dBmV D 3.97 dBmV
2019-09-16 01:33:18 U 43.78 dBmV D 3.96 dBmV
2019-09-16 01:34:19 U 43.78 dBmV D 3.96 dBmV
2019-09-16 01:35:18 U 43.78 dBmV D 4.03 dBmV
2019-09-16 01:36:18 U 43.78 dBmV D 4.00 dBmV
2019-09-16 01:37:18 U 43.78 dBmV D 3.98 dBmV
2019-09-16 01:38:17 U 43.78 dBmV D 3.97 dBmV
</code></pre><h2 id="get-data-with-python">Get Data With Python</h2>
<p>Script to get the data. The modem is quite &ldquo;finicky&rdquo;.</p>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999;font-style:italic">#!/usr/bin/python3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Comcast modem power levels reading script.</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Author: Eugenio C.</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Date: 09.16.2019</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># TODO: Rewrite this script into a module with calls to objects.</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># TODO: Put raw data in database. SQLite</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Load libraries</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">logging</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">re</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">smtplib</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">datetime</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">pickle</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">pathlib</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">os</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">sys</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">time</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">statistics</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">from</span> <span style="color:#447fcf;text-decoration:underline">email.message</span> <span style="color:#6ab825;font-weight:bold">import</span> EmailMessage
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">from</span> <span style="color:#447fcf;text-decoration:underline">bs4</span> <span style="color:#6ab825;font-weight:bold">import</span> BeautifulSoup <span style="color:#6ab825;font-weight:bold">as</span> bs
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">requests</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>DATAFILE = <span style="color:#ed9d13">&#39;cm_modem_pwr_levels.txt&#39;</span>
</span></span><span style="display:flex;"><span>WAIT_TIME = <span style="color:#3677a9">60</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># ********************************************************************************</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Function Declerations</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># ********************************************************************************</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">def</span> <span style="color:#447fcf">send_text</span>(msg_txt):
</span></span><span style="display:flex;"><span>    msg = EmailMessage()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    msg.set_content(msg_txt)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    msg[<span style="color:#ed9d13">&#39;Subject&#39;</span>] = <span style="color:#ed9d13">&#39;CM Alarm&#39;</span>
</span></span><span style="display:flex;"><span>    msg[<span style="color:#ed9d13">&#39;From&#39;</span>] = <span style="color:#ed9d13">&#39;python_script@yourdomain.com&#39;</span>
</span></span><span style="display:flex;"><span>    msg[<span style="color:#ed9d13">&#39;To&#39;</span>] = <span style="color:#ed9d13">&#39;phonenumber@vtext.com&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    smtp = smtplib.SMTP(<span style="color:#ed9d13">&#39;email.server.address&#39;</span>)
</span></span><span style="display:flex;"><span>    smtp.send_message(msg)
</span></span><span style="display:flex;"><span>    smtp.quit()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># ********************************************************************************</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Main Script</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># ********************************************************************************</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>ownp = os.path.abspath(os.path.dirname(sys.argv[<span style="color:#3677a9">0</span>]))
</span></span><span style="display:flex;"><span>tdnow = datetime.datetime.now().strftime(<span style="color:#ed9d13">&#34;%Y%m</span><span style="color:#ed9d13">%d</span><span style="color:#ed9d13">&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Setup Logging</span>
</span></span><span style="display:flex;"><span>logging.basicConfig(
</span></span><span style="display:flex;"><span>    <span style="color:#24909d">format</span>=<span style="color:#ed9d13">&#39;</span><span style="color:#ed9d13">%(asctime)s</span><span style="color:#ed9d13">:</span><span style="color:#ed9d13">%(levelname)s</span><span style="color:#ed9d13">:</span><span style="color:#ed9d13">%(message)s</span><span style="color:#ed9d13">&#39;</span>,
</span></span><span style="display:flex;"><span>    level=logging.DEBUG,
</span></span><span style="display:flex;"><span>    filename=ownp + <span style="color:#ed9d13">&#39;/cmpwrlevel2.log&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Get our &#34;browser&#34;</span>
</span></span><span style="display:flex;"><span>s = requests.Session()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Reload cookies from previous session if they exist</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">if</span> pathlib.Path(ownp + <span style="color:#ed9d13">&#39;/cookiefile2&#39;</span>).exists():
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">with</span> <span style="color:#24909d">open</span>(ownp + <span style="color:#ed9d13">&#39;/cookiefile2&#39;</span>, <span style="color:#ed9d13">&#39;rb&#39;</span>) <span style="color:#6ab825;font-weight:bold">as</span> f:
</span></span><span style="display:flex;"><span>        s.cookies.update(pickle.load(f))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Set url and authentication</span>
</span></span><span style="display:flex;"><span>url = <span style="color:#ed9d13">&#34;http://10.1.10.1/check.php&#34;</span>
</span></span><span style="display:flex;"><span>payload = {
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;username&#34;</span>: <span style="color:#ed9d13">&#34;cusadmin&#34;</span>, <span style="color:#999;font-style:italic"># Public, well known, customer-side, default credentials</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;password&#34;</span>: <span style="color:#ed9d13">&#34;highspeed&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Set our regex</span>
</span></span><span style="display:flex;"><span>regex = <span style="color:#ed9d13">r</span><span style="color:#ed9d13">&#39;&#34;Please Login First\!\&#34;&#39;</span>
</span></span><span style="display:flex;"><span>modemin = <span style="color:#6ab825;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Login loop, tries to connect to the modem.</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">while</span> <span style="color:#6ab825;font-weight:bold">not</span> modemin:
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># Login to set cookie</span>
</span></span><span style="display:flex;"><span>        logging.info(<span style="color:#ed9d13">&#34;Getting: </span><span style="color:#ed9d13">%s</span><span style="color:#ed9d13">&#34;</span> % url)
</span></span><span style="display:flex;"><span>        r = s.post(url, data=payload)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        logging.info(<span style="color:#ed9d13">&#34;Status Code: </span><span style="color:#ed9d13">%i</span><span style="color:#ed9d13">&#34;</span> % r.status_code)
</span></span><span style="display:flex;"><span>        r.raise_for_status()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">if</span> <span style="color:#6ab825;font-weight:bold">not</span> re.search(regex, <span style="color:#24909d">str</span>(r.content)):
</span></span><span style="display:flex;"><span>            logging.info(<span style="color:#ed9d13">&#34;Ok, we&#39;re in. Let&#39;s stay logged on and get data!&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            send_text(<span style="color:#ed9d13">&#34;Logged on!&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            modemin = <span style="color:#6ab825;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            logging.info(<span style="color:#ed9d13">&#34;No Luck! Let&#39;s try again in 10 seconds.&#34;</span>)
</span></span><span style="display:flex;"><span>            time.sleep(<span style="color:#3677a9">10</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">except</span> <span style="color:#bbb">Exception</span> <span style="color:#6ab825;font-weight:bold">as</span> e:
</span></span><span style="display:flex;"><span>        logging.error(e)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Save cookies</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">with</span> <span style="color:#24909d">open</span>(ownp + <span style="color:#ed9d13">&#39;/cookiefile2&#39;</span>, <span style="color:#ed9d13">&#39;wb&#39;</span>) <span style="color:#6ab825;font-weight:bold">as</span> f:
</span></span><span style="display:flex;"><span>    pickle.dump(s.cookies, f)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Now we can access the page we need</span>
</span></span><span style="display:flex;"><span>url = <span style="color:#ed9d13">&#34;http://10.1.10.1/comcast_network.php&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>getdata = <span style="color:#6ab825;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Let&#39;s start the data loop</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">while</span> getdata:
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>        logging.info(<span style="color:#ed9d13">&#34;Getting: </span><span style="color:#ed9d13">%s</span><span style="color:#ed9d13">&#34;</span> % url)
</span></span><span style="display:flex;"><span>        r = s.get(url)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        logging.info(<span style="color:#ed9d13">&#34;Status Code: </span><span style="color:#ed9d13">%i</span><span style="color:#ed9d13">&#34;</span> % r.status_code)
</span></span><span style="display:flex;"><span>        r.raise_for_status()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># Get the date/time close to the time we read the values</span>
</span></span><span style="display:flex;"><span>        currentDT = datetime.datetime.now()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># Get the html</span>
</span></span><span style="display:flex;"><span>        bs_content = bs(r.content, <span style="color:#ed9d13">&#34;lxml&#34;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># Narrow the html down to the two tables</span>
</span></span><span style="display:flex;"><span>        down_data = bs_content.find_all(<span style="color:#ed9d13">&#39;table&#39;</span>)[<span style="color:#3677a9">0</span>].get_text()
</span></span><span style="display:flex;"><span>        up_data = bs_content.find_all(<span style="color:#ed9d13">&#39;table&#39;</span>)[<span style="color:#3677a9">1</span>].get_text()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># Set our regex</span>
</span></span><span style="display:flex;"><span>        regex = <span style="color:#ed9d13">r</span><span style="color:#ed9d13">&#34;[-0-9\.]* dBmV&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># Get the power levels</span>
</span></span><span style="display:flex;"><span>        d_matches = re.finditer(regex, down_data, re.MULTILINE)
</span></span><span style="display:flex;"><span>        u_matches = re.finditer(regex, up_data, re.MULTILINE)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        d_pwr_sum = []
</span></span><span style="display:flex;"><span>        u_pwr_sum = []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># For each power level remove the label and convert to a number</span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># Sum up all the power levels so we can divide later for the average</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">for</span> d_matchNum, match <span style="color:#6ab825;font-weight:bold">in</span> <span style="color:#24909d">enumerate</span>(d_matches, start=<span style="color:#3677a9">1</span>):
</span></span><span style="display:flex;"><span>            d_pwr = <span style="color:#24909d">float</span>(match.group().replace(<span style="color:#ed9d13">&#34; dBmV&#34;</span>, <span style="color:#ed9d13">&#34;&#34;</span>))
</span></span><span style="display:flex;"><span>            d_pwr_sum.append(d_pwr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">for</span> u_matchNum, match <span style="color:#6ab825;font-weight:bold">in</span> <span style="color:#24909d">enumerate</span>(u_matches, start=<span style="color:#3677a9">1</span>):
</span></span><span style="display:flex;"><span>            u_pwr = <span style="color:#24909d">float</span>(match.group().replace(<span style="color:#ed9d13">&#34; dBmV&#34;</span>, <span style="color:#ed9d13">&#34;&#34;</span>))
</span></span><span style="display:flex;"><span>            u_pwr_sum.append(u_pwr)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># Print info to log file</span>
</span></span><span style="display:flex;"><span>        logging.info(<span style="color:#ed9d13">&#34;DW: </span><span style="color:#ed9d13">{}</span><span style="color:#ed9d13">&#34;</span>.format(<span style="color:#ed9d13">&#39;,&#39;</span>.join(<span style="color:#24909d">map</span>(<span style="color:#24909d">str</span>, d_pwr_sum))))
</span></span><span style="display:flex;"><span>        logging.info(<span style="color:#ed9d13">&#34;DW: H</span><span style="color:#ed9d13">%.1f</span><span style="color:#ed9d13">, L</span><span style="color:#ed9d13">%.1f</span><span style="color:#ed9d13">, M</span><span style="color:#ed9d13">%.1f</span><span style="color:#ed9d13">, A</span><span style="color:#ed9d13">%.2f</span><span style="color:#ed9d13">&#34;</span> %
</span></span><span style="display:flex;"><span>                     (<span style="color:#24909d">max</span>(d_pwr_sum),
</span></span><span style="display:flex;"><span>                      <span style="color:#24909d">min</span>(d_pwr_sum),
</span></span><span style="display:flex;"><span>                      statistics.median(d_pwr_sum),
</span></span><span style="display:flex;"><span>                      statistics.mean(d_pwr_sum)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        logging.info(<span style="color:#ed9d13">&#34;UP: </span><span style="color:#ed9d13">{}</span><span style="color:#ed9d13">&#34;</span>.format(<span style="color:#ed9d13">&#39;,&#39;</span>.join(<span style="color:#24909d">map</span>(<span style="color:#24909d">str</span>, u_pwr_sum))))
</span></span><span style="display:flex;"><span>        logging.info(<span style="color:#ed9d13">&#34;UP: H</span><span style="color:#ed9d13">%.1f</span><span style="color:#ed9d13">, L</span><span style="color:#ed9d13">%.1f</span><span style="color:#ed9d13">, M</span><span style="color:#ed9d13">%.1f</span><span style="color:#ed9d13">, A</span><span style="color:#ed9d13">%.2f</span><span style="color:#ed9d13">&#34;</span> %
</span></span><span style="display:flex;"><span>                     (<span style="color:#24909d">max</span>(u_pwr_sum),
</span></span><span style="display:flex;"><span>                      <span style="color:#24909d">min</span>(u_pwr_sum),
</span></span><span style="display:flex;"><span>                      statistics.median(u_pwr_sum),
</span></span><span style="display:flex;"><span>                      statistics.mean(u_pwr_sum)))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># Calculate the averages</span>
</span></span><span style="display:flex;"><span>        avg_u_pwr = statistics.mean(u_pwr_sum)
</span></span><span style="display:flex;"><span>        avg_d_pwr = statistics.mean(d_pwr_sum)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># If the power levels are outside of spec, send an alert text message</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">if</span> (avg_u_pwr &gt; <span style="color:#3677a9">49</span>) <span style="color:#6ab825;font-weight:bold">or</span> (avg_u_pwr &lt; <span style="color:#3677a9">40</span>) <span style="color:#6ab825;font-weight:bold">or</span> (avg_d_pwr &gt; <span style="color:#3677a9">10</span>) <span style="color:#6ab825;font-weight:bold">or</span> (avg_d_pwr &lt; -<span style="color:#3677a9">10</span>):
</span></span><span style="display:flex;"><span>            send_text(<span style="color:#ed9d13">&#34;U</span><span style="color:#ed9d13">%.2f</span><span style="color:#ed9d13"> D</span><span style="color:#ed9d13">%.2f</span><span style="color:#ed9d13">&#34;</span> % (avg_u_pwr, avg_d_pwr))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># Write data to file</span>
</span></span><span style="display:flex;"><span>        logging.info(<span style="color:#ed9d13">&#34;Writing data to: </span><span style="color:#ed9d13">%s</span><span style="color:#ed9d13">&#34;</span> % DATAFILE)
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">with</span> <span style="color:#24909d">open</span>(DATAFILE, <span style="color:#ed9d13">&#39;a&#39;</span>) <span style="color:#6ab825;font-weight:bold">as</span> o:
</span></span><span style="display:flex;"><span>            o.write(
</span></span><span style="display:flex;"><span>                <span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">%s</span><span style="color:#ed9d13"> U </span><span style="color:#ed9d13">%.2f</span><span style="color:#ed9d13"> dBmV D </span><span style="color:#ed9d13">%.2f</span><span style="color:#ed9d13"> dBmV</span><span style="color:#ed9d13">\n</span><span style="color:#ed9d13">&#34;</span> %
</span></span><span style="display:flex;"><span>                (currentDT.strftime(<span style="color:#ed9d13">&#34;%Y-%m-</span><span style="color:#ed9d13">%d</span><span style="color:#ed9d13"> %H:%M:%S&#34;</span>),
</span></span><span style="display:flex;"><span>                 avg_u_pwr,
</span></span><span style="display:flex;"><span>                 avg_d_pwr))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        logging.info(<span style="color:#ed9d13">&#34;Waiting </span><span style="color:#ed9d13">%i</span><span style="color:#ed9d13"> seconds.&#34;</span> % (WAIT_TIME))
</span></span><span style="display:flex;"><span>        time.sleep(WAIT_TIME)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">except</span> <span style="color:#bbb">Exception</span> <span style="color:#6ab825;font-weight:bold">as</span> e:
</span></span><span style="display:flex;"><span>        logging.error(e)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        send_text(<span style="color:#ed9d13">&#34;Exception!&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">with</span> <span style="color:#24909d">open</span>(ownp + <span style="color:#ed9d13">&#39;/content.html&#39;</span>, <span style="color:#ed9d13">&#39;w+&#39;</span>) <span style="color:#6ab825;font-weight:bold">as</span> h:
</span></span><span style="display:flex;"><span>            h.write(r.text)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># Exit loop, cron will restart</span>
</span></span><span style="display:flex;"><span>        getdata = <span style="color:#6ab825;font-weight:bold">False</span>
</span></span></code></pre></div><h2 id="sample-graphs">Sample Graphs</h2>
<h3 id="downstream-power-levels">Downstream Power Levels</h3>
<p><img src="/resources/cm_modem_dwn_pwr_levels.jpg" alt=""></p>
<h3 id="upstream-power-levels">Upstream Power Levels</h3>
<p><img src="/resources/cm_modem_up_pwr_levels.jpg" alt=""></p>
<h3 id="historical-graphs">Historical Graphs</h3>
<p>This is where you can really show line issues over time. You can see why we had random drops
at the begging of the graph. Some variance is expected on power levels, especially due to
temperature, but no mor than 2-3 decibels.</p>
<p>You can see where Comast finally fixed the issue. You can also see where we added back our splitter
for the TV.</p>
<p>Note: the gaps in the line is missing data. The modem sometimes does not repond to web requests.
After some time, it will now allow web logins, yet somehow, with the python script and reusing cookies
we are allowed in to collect data. Some times the page will refresh without the signal levels. Other
times, during line problems the page will not be available.</p>
<p><a href="/resources/history_down.jpg" target="_blank">Click here to see the full image&hellip;</a>
<img src="/resources/history_down.jpg" alt=""></p>
<p><a href="/resources/history_up.jpg" target="_blank">Click here to see the full image&hellip;</a>
<img src="/resources/history_up.jpg" alt=""></p>
<h2 id="generate-graphs-with-r">Generate Graphs With R</h2>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-R" data-lang="R"><span style="display:flex;"><span><span style="color:#999;font-style:italic">#!/usr/bin/env Rscript</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Comcast modem power levels plotting script.</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Author: Eugenio Cilento</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Date: 09.16.2019</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Load libraries</span>
</span></span><span style="display:flex;"><span><span style="color:#447fcf">library</span>(ggplot2, warn.conflicts = <span style="color:#6ab825;font-weight:bold">FALSE</span>)
</span></span><span style="display:flex;"><span><span style="color:#447fcf">library</span>(scales, warn.conflicts = <span style="color:#6ab825;font-weight:bold">FALSE</span>)
</span></span><span style="display:flex;"><span><span style="color:#447fcf">library</span>(ggrepel, warn.conflicts = <span style="color:#6ab825;font-weight:bold">FALSE</span>)
</span></span><span style="display:flex;"><span><span style="color:#447fcf">library</span>(lubridate, warn.conflicts = <span style="color:#6ab825;font-weight:bold">FALSE</span>)
</span></span><span style="display:flex;"><span><span style="color:#447fcf">library</span>(dplyr, warn.conflicts = <span style="color:#6ab825;font-weight:bold">FALSE</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>consts &lt;- <span style="color:#447fcf">list</span>(img_w = <span style="color:#3677a9">14</span>,
</span></span><span style="display:flex;"><span>    img_h = <span style="color:#3677a9">8.5</span>,
</span></span><span style="display:flex;"><span>    img_dpi = <span style="color:#3677a9">320</span>,
</span></span><span style="display:flex;"><span>    img_q = <span style="color:#3677a9">30</span>,
</span></span><span style="display:flex;"><span>    days = <span style="color:#3677a9">6</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># ***************************************************************************************</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Get the data, clean it up and get it ready for use in the graph.</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># ***************************************************************************************</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Read in the modem power levels from the text file.</span>
</span></span><span style="display:flex;"><span>pwr &lt;- <span style="color:#447fcf">read.table</span>(<span style="color:#ed9d13">&#34;cm_modem_pwr_levels.txt&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pwr = pwr<span style="color:#447fcf">[c</span>(<span style="color:#3677a9">-3</span>,<span style="color:#3677a9">-5</span>,<span style="color:#3677a9">-6</span>,<span style="color:#3677a9">-8</span>)] <span style="color:#999;font-style:italic"># Remove uneeded columns.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#447fcf">colnames</span>(pwr) = <span style="color:#447fcf">c</span>(<span style="color:#ed9d13">&#34;Date&#34;</span>,<span style="color:#ed9d13">&#34;Time&#34;</span>,<span style="color:#ed9d13">&#34;UP&#34;</span>,<span style="color:#ed9d13">&#34;DW&#34;</span>) <span style="color:#999;font-style:italic"># Let&#39;s give the columns some names.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pwr$DateTime &lt;- <span style="color:#447fcf">paste</span>(pwr$Date, pwr$Time) <span style="color:#999;font-style:italic"># Create a new timstamp column.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Create a new column used for the facets. Basically to show the Days on the graph.</span>
</span></span><span style="display:flex;"><span>pwr$Dow &lt;- <span style="color:#447fcf">strptime</span>(pwr$DateTime, <span style="color:#ed9d13">&#34;%Y-%m-%d&#34;</span>)
</span></span><span style="display:flex;"><span>pwr$Dow &lt;- <span style="color:#447fcf">format</span>(pwr$Dow, <span style="color:#ed9d13">&#34;%m-%d %a&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pwr = pwr<span style="color:#447fcf">[c</span>(<span style="color:#3677a9">-1</span>,<span style="color:#3677a9">-2</span>)] <span style="color:#999;font-style:italic"># Some more cleanup.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Make that column an actual date time field</span>
</span></span><span style="display:flex;"><span>pwr$DateTime &lt;- <span style="color:#447fcf">strptime</span>(pwr$DateTime, <span style="color:#ed9d13">&#34;%Y-%m-%d %H:%M:%S&#34;</span>)
</span></span><span style="display:flex;"><span>pwr$DateTime &lt;- <span style="color:#447fcf">as.POSIXct</span>(pwr$DateTime, tz = <span style="color:#ed9d13">&#34;America/Chicago&#34;</span>) <span style="color:#999;font-style:italic"># Convert to POSIXct type</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>pwr &lt;- pwr[pwr$DateTime &gt;= <span style="color:#447fcf">as.POSIXct</span>(<span style="color:#447fcf">Sys.Date</span>()-consts$days),] <span style="color:#999;font-style:italic"># Limit the data.</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># When did the modem signal go outside of the acceptable range?</span>
</span></span><span style="display:flex;"><span>pwrovr &lt;- pwr<span style="color:#447fcf">[which</span>(pwr[,<span style="color:#3677a9">1</span>] &gt; <span style="color:#3677a9">49</span> | pwr[,<span style="color:#3677a9">1</span>] &lt; <span style="color:#3677a9">35</span> ),]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Dataframe for ranges</span>
</span></span><span style="display:flex;"><span>dmax &lt;- pwr %&gt;% <span style="color:#447fcf">group_by</span>(Dow) %&gt;% <span style="color:#447fcf">summarise</span>(Max = <span style="color:#447fcf">max</span>(DateTime))
</span></span><span style="display:flex;"><span>dmin &lt;- pwr %&gt;% <span style="color:#447fcf">group_by</span>(Dow) %&gt;% <span style="color:#447fcf">summarise</span>(Min = <span style="color:#447fcf">min</span>(DateTime))
</span></span><span style="display:flex;"><span>dminmax &lt;- <span style="color:#447fcf">merge</span>(dmax,dmin,by = <span style="color:#ed9d13">&#34;Dow&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Put in variables so we dont have to repeat code</span>
</span></span><span style="display:flex;"><span>dta = <span style="color:#447fcf">as.POSIXct</span>(<span style="color:#447fcf">Sys.Date</span>())
</span></span><span style="display:flex;"><span>dtw = <span style="color:#447fcf">format</span>(<span style="color:#447fcf">as.POSIXct</span>(<span style="color:#447fcf">Sys.Date</span>()), <span style="color:#ed9d13">&#34;%m-%d %a&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># ***************************************************************************************</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Beginning of the UPSTREAM graph script.</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># ***************************************************************************************</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Dataframe for text labels for ranges</span>
</span></span><span style="display:flex;"><span>text_ann &lt;- <span style="color:#447fcf">data.frame</span>(UP = <span style="color:#3677a9">49</span>, DW = <span style="color:#3677a9">5</span>,
</span></span><span style="display:flex;"><span>  lab = <span style="color:#ed9d13">&#34;Packet Loss\nBegins: +49&#34;</span>, DateTime = dta, Dow = dtw)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>text_ann &lt;- <span style="color:#447fcf">rbind</span>(text_ann, 
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">data.frame</span>(UP = <span style="color:#3677a9">35</span>, DW = <span style="color:#3677a9">5</span>, 
</span></span><span style="display:flex;"><span>    lab = <span style="color:#ed9d13">&#34;Recommended:\n+ 35 - 47&#34;</span>, DateTime = dta, Dow = dtw))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#447fcf">hour</span>(text_ann$DateTime) = <span style="color:#3677a9">2</span> <span style="color:#999;font-style:italic">#position of text within facet</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Create the plot</span>
</span></span><span style="display:flex;"><span>gg &lt;- <span style="color:#447fcf">ggplot</span>(pwr, <span style="color:#447fcf">aes</span>(DateTime, UP)) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_point</span>( <span style="color:#999;font-style:italic"># Points on a graph seem to work best for this type data.</span>
</span></span><span style="display:flex;"><span>    color = <span style="color:#ed9d13">&#34;black&#34;</span>,
</span></span><span style="display:flex;"><span>    size = <span style="color:#3677a9">.1</span>
</span></span><span style="display:flex;"><span>  ) + 
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">facet_grid</span>( <span style="color:#999;font-style:italic"># This gives the days in a nice column.</span>
</span></span><span style="display:flex;"><span>    col = <span style="color:#447fcf">vars</span>(Dow),
</span></span><span style="display:flex;"><span>    labeller = <span style="color:#447fcf">labeller</span>(Dow = <span style="color:#447fcf">label_wrap_gen</span>(<span style="color:#3677a9">5</span>)), <span style="color:#999;font-style:italic"># Word rap the labels.</span>
</span></span><span style="display:flex;"><span>    space = <span style="color:#ed9d13">&#39;free&#39;</span>, 
</span></span><span style="display:flex;"><span>    scales = <span style="color:#ed9d13">&#39;free&#39;</span>, 
</span></span><span style="display:flex;"><span>    switch = <span style="color:#ed9d13">&#39;x&#39;</span>
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">labs</span>( <span style="color:#999;font-style:italic"># Needs some good titles and labels to make it easier to understand.</span>
</span></span><span style="display:flex;"><span>    title=<span style="color:#ed9d13">&#34;Cable Modem Upstream Power&#34;</span>, 
</span></span><span style="display:flex;"><span>    subtitle=<span style="color:#ed9d13">&#34;Comcast Business Internet&#34;</span>, 
</span></span><span style="display:flex;"><span>    y=<span style="color:#ed9d13">&#34;Upstream Power Level (dBmV)&#34;</span>, 
</span></span><span style="display:flex;"><span>    x=<span style="color:#ed9d13">&#34;Time (Date &amp; Hour in 24Hr format)&#34;</span>, 
</span></span><span style="display:flex;"><span>    caption= <span style="color:#447fcf">paste</span>( <span style="color:#999;font-style:italic"># Timestamp the graph.</span>
</span></span><span style="display:flex;"><span>      <span style="color:#ed9d13">&#34;International Assurance of TN, Inc. IT Department -&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#447fcf">Sys.time</span>()
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_rect</span>( <span style="color:#999;font-style:italic"># color the acceptable range so it stands out.</span>
</span></span><span style="display:flex;"><span>    data = dminmax, 
</span></span><span style="display:flex;"><span>    <span style="color:#447fcf">aes</span>(
</span></span><span style="display:flex;"><span>      xmin = Min, 
</span></span><span style="display:flex;"><span>      xmax = Max, 
</span></span><span style="display:flex;"><span>      ymin = <span style="color:#3677a9">35</span>, 
</span></span><span style="display:flex;"><span>      ymax = <span style="color:#3677a9">47</span>), 
</span></span><span style="display:flex;"><span>    alpha = <span style="color:#3677a9">0.2</span>, 
</span></span><span style="display:flex;"><span>    fill=<span style="color:#ed9d13">&#34;green&#34;</span>, 
</span></span><span style="display:flex;"><span>    inherit.aes = <span style="color:#6ab825;font-weight:bold">FALSE</span>
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_rect</span>( <span style="color:#999;font-style:italic"># color the acceptable range so it stands out.</span>
</span></span><span style="display:flex;"><span>    data = dminmax, 
</span></span><span style="display:flex;"><span>    <span style="color:#447fcf">aes</span>(
</span></span><span style="display:flex;"><span>      xmin = Min, 
</span></span><span style="display:flex;"><span>      xmax = Max, 
</span></span><span style="display:flex;"><span>      ymin = <span style="color:#3677a9">47</span>, 
</span></span><span style="display:flex;"><span>      ymax = <span style="color:#3677a9">49</span>), 
</span></span><span style="display:flex;"><span>    alpha = <span style="color:#3677a9">0.2</span>, 
</span></span><span style="display:flex;"><span>    fill=<span style="color:#ed9d13">&#34;red&#34;</span>, 
</span></span><span style="display:flex;"><span>    inherit.aes = <span style="color:#6ab825;font-weight:bold">FALSE</span>
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_text</span>( <span style="color:#999;font-style:italic"># add labels for the ranges</span>
</span></span><span style="display:flex;"><span>    data = text_ann, 
</span></span><span style="display:flex;"><span>    <span style="color:#447fcf">aes</span>(x=DateTime, y=UP, label=lab), 
</span></span><span style="display:flex;"><span>    vjust=<span style="color:#3677a9">-.2</span>,
</span></span><span style="display:flex;"><span>    hjust=<span style="color:#3677a9">0</span>,
</span></span><span style="display:flex;"><span>    size=<span style="color:#3677a9">2.5</span>,
</span></span><span style="display:flex;"><span>    color= <span style="color:#ed9d13">&#34;black&#34;</span>
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_hline</span>(yintercept=<span style="color:#3677a9">49</span>, linetype=<span style="color:#ed9d13">&#34;dashed&#34;</span>, color = <span style="color:#ed9d13">&#34;red&#34;</span>) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_hline</span>(yintercept=<span style="color:#3677a9">47</span>, linetype=<span style="color:#ed9d13">&#34;dashed&#34;</span>, color = <span style="color:#ed9d13">&#34;green&#34;</span>) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_hline</span>(yintercept=<span style="color:#3677a9">35</span>, linetype=<span style="color:#ed9d13">&#34;dashed&#34;</span>, color = <span style="color:#ed9d13">&#34;green&#34;</span>) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">coord_cartesian</span>( <span style="color:#999;font-style:italic"># Set the y scale. The range of modem signal levels.</span>
</span></span><span style="display:flex;"><span>    ylim = <span style="color:#447fcf">c</span>(<span style="color:#3677a9">0</span>, <span style="color:#3677a9">60</span>)
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">scale_y_continuous</span>( <span style="color:#999;font-style:italic"># Set where the lines show on the graph.</span>
</span></span><span style="display:flex;"><span>    minor_breaks = <span style="color:#447fcf">seq</span>(<span style="color:#3677a9">0</span> , <span style="color:#3677a9">60</span>, <span style="color:#3677a9">1</span>), 
</span></span><span style="display:flex;"><span>    breaks = <span style="color:#447fcf">seq</span>(<span style="color:#3677a9">0</span>, <span style="color:#3677a9">60</span>, <span style="color:#3677a9">10</span>)
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">scale_x_datetime</span>( <span style="color:#999;font-style:italic"># Set the x scale based on the hour of the day.</span>
</span></span><span style="display:flex;"><span>    breaks = <span style="color:#447fcf">pretty_breaks</span>(), <span style="color:#999;font-style:italic"># Makes the hours fit nicely in a day.</span>
</span></span><span style="display:flex;"><span>    expand = <span style="color:#447fcf">c</span>(<span style="color:#3677a9">0</span>, <span style="color:#3677a9">0</span>), <span style="color:#999;font-style:italic"># Brings the panel/facets together, seamless transition from day to day.</span>
</span></span><span style="display:flex;"><span>    labels = <span style="color:#447fcf">date_format</span>(<span style="color:#ed9d13">&#34;%H&#34;</span>, tz = <span style="color:#447fcf">Sys.timezone</span>(location = <span style="color:#6ab825;font-weight:bold">TRUE</span>)), 
</span></span><span style="display:flex;"><span>    date_breaks = <span style="color:#ed9d13">&#34;2 hour&#34;</span>,
</span></span><span style="display:flex;"><span>    date_minor_breaks = <span style="color:#ed9d13">&#34;1 hour&#34;</span>
</span></span><span style="display:flex;"><span>  ) + 
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">theme_bw</span>() + <span style="color:#999;font-style:italic"># Start off with a base theme, then modify it.</span>
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">theme</span>(
</span></span><span style="display:flex;"><span>    panel.border = <span style="color:#447fcf">element_rect</span>(
</span></span><span style="display:flex;"><span>      color = <span style="color:#ed9d13">&#34;dark gray&#34;</span>),
</span></span><span style="display:flex;"><span>    panel.spacing.x = <span style="color:#447fcf">unit</span>(<span style="color:#3677a9">0</span>,<span style="color:#ed9d13">&#34;line&#34;</span>),
</span></span><span style="display:flex;"><span>    strip.placement = <span style="color:#ed9d13">&#34;outside&#34;</span>,
</span></span><span style="display:flex;"><span>    strip.text.x = <span style="color:#447fcf">element_text</span>(
</span></span><span style="display:flex;"><span>      size = <span style="color:#3677a9">6</span>
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    panel.grid.major = <span style="color:#447fcf">element_line</span>(
</span></span><span style="display:flex;"><span>      color = <span style="color:#ed9d13">&#34;light gray&#34;</span>),
</span></span><span style="display:flex;"><span>    panel.grid.minor = <span style="color:#447fcf">element_line</span>(
</span></span><span style="display:flex;"><span>      color = <span style="color:#ed9d13">&#34;light gray&#34;</span>
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    axis.text.x = <span style="color:#447fcf">element_text</span>( <span style="color:#999;font-style:italic"># Hour of the day</span>
</span></span><span style="display:flex;"><span>      size = <span style="color:#3677a9">6</span>,
</span></span><span style="display:flex;"><span>      angle = <span style="color:#3677a9">90</span>,
</span></span><span style="display:flex;"><span>      vjust = <span style="color:#3677a9">0.5</span>,
</span></span><span style="display:flex;"><span>      hjust = <span style="color:#3677a9">0.5</span>),
</span></span><span style="display:flex;"><span>    axis.line = <span style="color:#447fcf">element_line</span>( <span style="color:#999;font-style:italic"># Make the axis stand out.</span>
</span></span><span style="display:flex;"><span>      color = <span style="color:#ed9d13">&#34;darkblue&#34;</span>, 
</span></span><span style="display:flex;"><span>      size = <span style="color:#3677a9">1</span>, 
</span></span><span style="display:flex;"><span>      linetype = <span style="color:#ed9d13">&#34;solid&#34;</span>)
</span></span><span style="display:flex;"><span>  ) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#447fcf">if </span>(<span style="color:#447fcf">dim</span>(pwrovr)[1] != <span style="color:#3677a9">0</span>) { <span style="color:#999;font-style:italic"># Make sure we have out of range plots before adding them </span>
</span></span><span style="display:flex;"><span>  gg = gg +
</span></span><span style="display:flex;"><span>    <span style="color:#447fcf">geom_text_repel</span>( <span style="color:#999;font-style:italic"># Label the out-of-range plots</span>
</span></span><span style="display:flex;"><span>      <span style="color:#447fcf">aes</span>(label = <span style="color:#447fcf">paste</span>(<span style="color:#447fcf">hour</span>(DateTime),<span style="color:#ed9d13">&#34;:&#34;</span>, <span style="color:#447fcf">minute</span>(DateTime),<span style="color:#ed9d13">&#34;-&#34;</span>,UP)), 
</span></span><span style="display:flex;"><span>      pwrovr,
</span></span><span style="display:flex;"><span>      size = <span style="color:#3677a9">2</span>,
</span></span><span style="display:flex;"><span>      color = <span style="color:#ed9d13">&#34;red&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Save the graph to a JPEG file. High resolution allows more clarity and printability.</span>
</span></span><span style="display:flex;"><span><span style="color:#447fcf">ggsave</span>(<span style="color:#ed9d13">&#34;cm_modem_up_pwr_levels.jpg&#34;</span>, 
</span></span><span style="display:flex;"><span>       width = consts$img_w, 
</span></span><span style="display:flex;"><span>       height = consts$img_h, 
</span></span><span style="display:flex;"><span>       dpi = consts$img_dpi,
</span></span><span style="display:flex;"><span>       quality = consts$img_q,
</span></span><span style="display:flex;"><span>       limitsize = <span style="color:#6ab825;font-weight:bold">FALSE</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># ***************************************************************************************</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Beginning of the DOWNSTREAM graph script.</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># ***************************************************************************************</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Dataframe for text labels for  ranges</span>
</span></span><span style="display:flex;"><span>text_ann2 &lt;- <span style="color:#447fcf">data.frame</span>(UP = <span style="color:#3677a9">-6</span>, DW = <span style="color:#3677a9">5</span>,
</span></span><span style="display:flex;"><span>  lab = <span style="color:#ed9d13">&#34;Recommended:\n-7 to 7&#34;</span>, DateTime = dta, Dow = dtw)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>text_ann2 &lt;- <span style="color:#447fcf">rbind</span>(text_ann2, 
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">data.frame</span>(UP = <span style="color:#3677a9">-9</span>, DW = <span style="color:#3677a9">5</span>, 
</span></span><span style="display:flex;"><span>    lab = <span style="color:#ed9d13">&#34;Acceptable:\n+- 7 to 10&#34;</span>, DateTime = dta, Dow = dtw))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>text_ann2 &lt;- <span style="color:#447fcf">rbind</span>(text_ann2, 
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">data.frame</span>(UP = <span style="color:#3677a9">-14</span>, DW = <span style="color:#3677a9">5</span>, 
</span></span><span style="display:flex;"><span>    lab = <span style="color:#ed9d13">&#34;Maximum:\n+- 10 to 15 &#34;</span>, DateTime = dta, Dow = dtw))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>text_ann2 &lt;- <span style="color:#447fcf">rbind</span>(text_ann2, 
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">data.frame</span>(UP = <span style="color:#3677a9">-18</span>, DW = <span style="color:#3677a9">5</span>, 
</span></span><span style="display:flex;"><span>    lab = <span style="color:#ed9d13">&#34;Out of Spec:\n&gt; +-15 &#34;</span>, DateTime = dta, Dow = dtw))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#447fcf">hour</span>(text_ann2$DateTime) = <span style="color:#3677a9">2</span> <span style="color:#999;font-style:italic">#position of text within facet</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Filter into a new table the out-of-range instances.</span>
</span></span><span style="display:flex;"><span>pwrovr &lt;- pwr<span style="color:#447fcf">[which</span>(pwr[,<span style="color:#3677a9">2</span>] &gt; <span style="color:#3677a9">10</span> | pwr[,<span style="color:#3677a9">2</span>] &lt; <span style="color:#3677a9">-10</span> ),]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Generate the downstream graph. Identical to upstream but with different ranges.</span>
</span></span><span style="display:flex;"><span>gg &lt;- <span style="color:#447fcf">ggplot</span>(pwr, <span style="color:#447fcf">aes</span>(DateTime, DW)) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_point</span>(
</span></span><span style="display:flex;"><span>    color = <span style="color:#ed9d13">&#34;black&#34;</span>,
</span></span><span style="display:flex;"><span>    size = <span style="color:#3677a9">.1</span>
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">facet_grid</span>(
</span></span><span style="display:flex;"><span>    col = <span style="color:#447fcf">vars</span>(Dow),
</span></span><span style="display:flex;"><span>    labeller = <span style="color:#447fcf">labeller</span>(Dow = <span style="color:#447fcf">label_wrap_gen</span>(<span style="color:#3677a9">5</span>)),
</span></span><span style="display:flex;"><span>    space = <span style="color:#ed9d13">&#39;free&#39;</span>, 
</span></span><span style="display:flex;"><span>    scales = <span style="color:#ed9d13">&#39;free&#39;</span>, 
</span></span><span style="display:flex;"><span>    switch = <span style="color:#ed9d13">&#39;x&#39;</span>
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">coord_cartesian</span>(
</span></span><span style="display:flex;"><span>    ylim = <span style="color:#447fcf">c</span>(<span style="color:#3677a9">-30</span>, <span style="color:#3677a9">20</span>)
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">scale_y_continuous</span>(
</span></span><span style="display:flex;"><span>    minor_breaks = <span style="color:#447fcf">seq</span>(<span style="color:#3677a9">-30</span> , <span style="color:#3677a9">20</span>, <span style="color:#3677a9">1</span>), 
</span></span><span style="display:flex;"><span>    breaks = <span style="color:#447fcf">seq</span>(<span style="color:#3677a9">-30</span>, <span style="color:#3677a9">20</span>, <span style="color:#3677a9">10</span>)
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">labs</span>(
</span></span><span style="display:flex;"><span>    title=<span style="color:#ed9d13">&#34;Cable Modem Downstream Power&#34;</span>,
</span></span><span style="display:flex;"><span>    subtitle=<span style="color:#ed9d13">&#34;Comcast Business Internet&#34;</span>,
</span></span><span style="display:flex;"><span>    y=<span style="color:#ed9d13">&#34;Downstream Power Level (dBmV)&#34;</span>,
</span></span><span style="display:flex;"><span>    x=<span style="color:#ed9d13">&#34;Time (Date &amp; Hour in 24Hr format)&#34;</span>,
</span></span><span style="display:flex;"><span>    caption= <span style="color:#447fcf">paste</span>(
</span></span><span style="display:flex;"><span>      <span style="color:#ed9d13">&#34;International Assurance of TN, Inc. IT Department -&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#447fcf">Sys.time</span>()
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_text</span>( <span style="color:#999;font-style:italic"># write the labels for the ranges</span>
</span></span><span style="display:flex;"><span>    data = text_ann2, 
</span></span><span style="display:flex;"><span>    <span style="color:#447fcf">aes</span>(x=DateTime, y=UP, label=lab), 
</span></span><span style="display:flex;"><span>    vjust=<span style="color:#3677a9">.3</span>,
</span></span><span style="display:flex;"><span>    hjust=<span style="color:#3677a9">0</span>,
</span></span><span style="display:flex;"><span>    size=<span style="color:#3677a9">2.5</span>,
</span></span><span style="display:flex;"><span>    color= <span style="color:#ed9d13">&#34;black&#34;</span>
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_hline</span>(yintercept=<span style="color:#3677a9">-15</span>, linetype=<span style="color:#ed9d13">&#34;dashed&#34;</span>, color = <span style="color:#ed9d13">&#34;red&#34;</span>) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_hline</span>(yintercept=<span style="color:#3677a9">-10</span>, linetype=<span style="color:#ed9d13">&#34;dashed&#34;</span>, color = <span style="color:#ed9d13">&#34;yellow&#34;</span>) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_hline</span>(yintercept=<span style="color:#3677a9">-7</span>, linetype=<span style="color:#ed9d13">&#34;dashed&#34;</span>, color = <span style="color:#ed9d13">&#34;green&#34;</span>) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_hline</span>(yintercept=<span style="color:#3677a9">7</span>, linetype=<span style="color:#ed9d13">&#34;dashed&#34;</span>, color = <span style="color:#ed9d13">&#34;green&#34;</span>) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_hline</span>(yintercept=<span style="color:#3677a9">10</span>, linetype=<span style="color:#ed9d13">&#34;dashed&#34;</span>, color = <span style="color:#ed9d13">&#34;yellow&#34;</span>) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_hline</span>(yintercept=<span style="color:#3677a9">15</span>, linetype=<span style="color:#ed9d13">&#34;dashed&#34;</span>, color = <span style="color:#ed9d13">&#34;red&#34;</span>) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_rect</span>( <span style="color:#999;font-style:italic"># color the acceptable range so it stands out.</span>
</span></span><span style="display:flex;"><span>    data = dminmax, 
</span></span><span style="display:flex;"><span>    <span style="color:#447fcf">aes</span>(
</span></span><span style="display:flex;"><span>      xmin = Min, 
</span></span><span style="display:flex;"><span>      xmax = Max, 
</span></span><span style="display:flex;"><span>      ymin = <span style="color:#3677a9">-7</span>, 
</span></span><span style="display:flex;"><span>      ymax = <span style="color:#3677a9">7</span>), 
</span></span><span style="display:flex;"><span>    alpha = <span style="color:#3677a9">0.2</span>, 
</span></span><span style="display:flex;"><span>    fill=<span style="color:#ed9d13">&#34;green&#34;</span>, 
</span></span><span style="display:flex;"><span>    inherit.aes = <span style="color:#6ab825;font-weight:bold">FALSE</span>
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_rect</span>( <span style="color:#999;font-style:italic"># color the acceptable range so it stands out.</span>
</span></span><span style="display:flex;"><span>    data = dminmax, 
</span></span><span style="display:flex;"><span>    <span style="color:#447fcf">aes</span>(
</span></span><span style="display:flex;"><span>      xmin = Min, 
</span></span><span style="display:flex;"><span>      xmax = Max, 
</span></span><span style="display:flex;"><span>      ymin = <span style="color:#3677a9">-10</span>, 
</span></span><span style="display:flex;"><span>      ymax = <span style="color:#3677a9">-7</span>), 
</span></span><span style="display:flex;"><span>    alpha = <span style="color:#3677a9">0.2</span>, 
</span></span><span style="display:flex;"><span>    fill=<span style="color:#ed9d13">&#34;yellow&#34;</span>, 
</span></span><span style="display:flex;"><span>    inherit.aes = <span style="color:#6ab825;font-weight:bold">FALSE</span>
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_rect</span>( <span style="color:#999;font-style:italic"># color the acceptable range so it stands out.</span>
</span></span><span style="display:flex;"><span>    data = dminmax, 
</span></span><span style="display:flex;"><span>    <span style="color:#447fcf">aes</span>(
</span></span><span style="display:flex;"><span>      xmin = Min, 
</span></span><span style="display:flex;"><span>      xmax = Max, 
</span></span><span style="display:flex;"><span>      ymin = <span style="color:#3677a9">7</span>, 
</span></span><span style="display:flex;"><span>      ymax = <span style="color:#3677a9">10</span>), 
</span></span><span style="display:flex;"><span>    alpha = <span style="color:#3677a9">0.2</span>, 
</span></span><span style="display:flex;"><span>    fill=<span style="color:#ed9d13">&#34;yellow&#34;</span>, 
</span></span><span style="display:flex;"><span>    inherit.aes = <span style="color:#6ab825;font-weight:bold">FALSE</span>
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>   <span style="color:#447fcf">geom_rect</span>( <span style="color:#999;font-style:italic"># color the acceptable range so it stands out.</span>
</span></span><span style="display:flex;"><span>    data = dminmax, 
</span></span><span style="display:flex;"><span>    <span style="color:#447fcf">aes</span>(
</span></span><span style="display:flex;"><span>      xmin = Min, 
</span></span><span style="display:flex;"><span>      xmax = Max, 
</span></span><span style="display:flex;"><span>      ymin = <span style="color:#3677a9">-15</span>, 
</span></span><span style="display:flex;"><span>      ymax = <span style="color:#3677a9">-10</span>), 
</span></span><span style="display:flex;"><span>    alpha = <span style="color:#3677a9">0.2</span>, 
</span></span><span style="display:flex;"><span>    fill=<span style="color:#ed9d13">&#34;red&#34;</span>, 
</span></span><span style="display:flex;"><span>    inherit.aes = <span style="color:#6ab825;font-weight:bold">FALSE</span>
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">geom_rect</span>( <span style="color:#999;font-style:italic"># color the acceptable range so it stands out.</span>
</span></span><span style="display:flex;"><span>    data = dminmax, 
</span></span><span style="display:flex;"><span>    <span style="color:#447fcf">aes</span>(
</span></span><span style="display:flex;"><span>      xmin = Min, 
</span></span><span style="display:flex;"><span>      xmax = Max, 
</span></span><span style="display:flex;"><span>      ymin = <span style="color:#3677a9">10</span>, 
</span></span><span style="display:flex;"><span>      ymax = <span style="color:#3677a9">15</span>), 
</span></span><span style="display:flex;"><span>    alpha = <span style="color:#3677a9">0.2</span>, 
</span></span><span style="display:flex;"><span>    fill=<span style="color:#ed9d13">&#34;red&#34;</span>, 
</span></span><span style="display:flex;"><span>    inherit.aes = <span style="color:#6ab825;font-weight:bold">FALSE</span>
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">scale_x_datetime</span>(
</span></span><span style="display:flex;"><span>    breaks = <span style="color:#447fcf">pretty_breaks</span>(),
</span></span><span style="display:flex;"><span>    expand = <span style="color:#447fcf">c</span>(<span style="color:#3677a9">0</span>, <span style="color:#3677a9">0</span>),
</span></span><span style="display:flex;"><span>    labels = <span style="color:#447fcf">date_format</span>(<span style="color:#ed9d13">&#34;%H&#34;</span>, tz = <span style="color:#447fcf">Sys.timezone</span>(location = <span style="color:#6ab825;font-weight:bold">TRUE</span>)),
</span></span><span style="display:flex;"><span>    date_breaks = <span style="color:#ed9d13">&#34;2 hour&#34;</span>,
</span></span><span style="display:flex;"><span>    date_minor_breaks = <span style="color:#ed9d13">&#34;1 hour&#34;</span>
</span></span><span style="display:flex;"><span>  ) +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">theme_bw</span>() +
</span></span><span style="display:flex;"><span>  <span style="color:#447fcf">theme</span>(
</span></span><span style="display:flex;"><span>    panel.border = <span style="color:#447fcf">element_rect</span>(
</span></span><span style="display:flex;"><span>      colour = <span style="color:#ed9d13">&#34;dark gray&#34;</span>),
</span></span><span style="display:flex;"><span>    panel.spacing.x = <span style="color:#447fcf">unit</span>(<span style="color:#3677a9">0</span>,<span style="color:#ed9d13">&#34;line&#34;</span>),
</span></span><span style="display:flex;"><span>    strip.placement = <span style="color:#ed9d13">&#34;outside&#34;</span>,
</span></span><span style="display:flex;"><span>    strip.text.x = <span style="color:#447fcf">element_text</span>(
</span></span><span style="display:flex;"><span>      size = <span style="color:#3677a9">6</span>
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    panel.grid.major = <span style="color:#447fcf">element_line</span>(
</span></span><span style="display:flex;"><span>      colour = <span style="color:#ed9d13">&#34;light gray&#34;</span>),
</span></span><span style="display:flex;"><span>    panel.grid.minor = <span style="color:#447fcf">element_line</span>(
</span></span><span style="display:flex;"><span>      color = <span style="color:#ed9d13">&#34;light gray&#34;</span>
</span></span><span style="display:flex;"><span>    ),
</span></span><span style="display:flex;"><span>    axis.text.x = <span style="color:#447fcf">element_text</span>(
</span></span><span style="display:flex;"><span>      size = <span style="color:#3677a9">6</span>,
</span></span><span style="display:flex;"><span>      angle = <span style="color:#3677a9">90</span>,
</span></span><span style="display:flex;"><span>      vjust = <span style="color:#3677a9">0.5</span>,
</span></span><span style="display:flex;"><span>      hjust = <span style="color:#3677a9">0.5</span>),
</span></span><span style="display:flex;"><span>    axis.line = <span style="color:#447fcf">element_line</span>(
</span></span><span style="display:flex;"><span>      colour = <span style="color:#ed9d13">&#34;darkblue&#34;</span>, 
</span></span><span style="display:flex;"><span>      size = <span style="color:#3677a9">1</span>, 
</span></span><span style="display:flex;"><span>      linetype = <span style="color:#ed9d13">&#34;solid&#34;</span>)
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#447fcf">if </span>(<span style="color:#447fcf">dim</span>(pwrovr)[1] != <span style="color:#3677a9">0</span>) {  <span style="color:#999;font-style:italic"># Make sure we have out of range before plotting</span>
</span></span><span style="display:flex;"><span>  gg = gg +
</span></span><span style="display:flex;"><span>    <span style="color:#447fcf">geom_text_repel</span>( <span style="color:#999;font-style:italic"># Label the out-of-range plots</span>
</span></span><span style="display:flex;"><span>      <span style="color:#447fcf">aes</span>(label = <span style="color:#447fcf">paste</span>(DateTime, <span style="color:#ed9d13">&#34;-&#34;</span>, DW, <span style="color:#ed9d13">&#34;dBmV&#34;</span>)),
</span></span><span style="display:flex;"><span>      pwrovr,
</span></span><span style="display:flex;"><span>      size = <span style="color:#3677a9">2</span>,
</span></span><span style="display:flex;"><span>      color = <span style="color:#ed9d13">&#34;red&#34;</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Save graph to file.</span>
</span></span><span style="display:flex;"><span><span style="color:#447fcf">ggsave</span>(<span style="color:#ed9d13">&#34;cm_modem_dwn_pwr_levels.jpg&#34;</span>, 
</span></span><span style="display:flex;"><span>       width = consts$img_w, 
</span></span><span style="display:flex;"><span>       height = consts$img_h, 
</span></span><span style="display:flex;"><span>       dpi = consts$img_dpi,
</span></span><span style="display:flex;"><span>       quality = consts$img_q,
</span></span><span style="display:flex;"><span>       limitsize = <span style="color:#6ab825;font-weight:bold">FALSE</span>)
</span></span></code></pre></div>
    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
