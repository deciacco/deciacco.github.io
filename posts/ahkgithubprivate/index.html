<!doctype html>
<html lang="en-us">
  <head>
    <title>Private GitHub Repo and Autohokey // deciacco</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.57.2" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="eugenio c." />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://deciacco.github.io/css/main.min.e0a740700d179dfcce46daf97c59dd99be917ec764b052d3f8e89ec6f03fcdc4.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Private GitHub Repo and Autohokey"/>
<meta name="twitter:description" content="How to connect to a GitHub Private Repository to download files.
This can be useful if you want to automatically update your application to the latest release.
#SingleInstance, force #NoEnv #Include %A_ScriptDir%\..\json\JSON.ahk ;https://github.com/cocobelgica/AutoHotkey-JSON ;------------------------------------------------------------------ ;GLOBALS global g_url := &#34;https://api.github.com/repos/&lt;username&gt;/&lt;repository&gt;/releases&#34; global g_file := &#34;filename.zip&#34; global g_saveto := A_Desktop . &#34;/&#34; . g_file ; You need to generate this in your github account global g_token := &#34;74jf8gh7ihdg9orlkk948rjfugnry369jgirn857&#34; ; &lt;-- not a real token, demo purposes ;------------------------------------------------------------------ ;MAIN CODE r := false request := comobjcreate(&#34;WinHttp."/>

    <meta property="og:title" content="Private GitHub Repo and Autohokey" />
<meta property="og:description" content="How to connect to a GitHub Private Repository to download files.
This can be useful if you want to automatically update your application to the latest release.
#SingleInstance, force #NoEnv #Include %A_ScriptDir%\..\json\JSON.ahk ;https://github.com/cocobelgica/AutoHotkey-JSON ;------------------------------------------------------------------ ;GLOBALS global g_url := &#34;https://api.github.com/repos/&lt;username&gt;/&lt;repository&gt;/releases&#34; global g_file := &#34;filename.zip&#34; global g_saveto := A_Desktop . &#34;/&#34; . g_file ; You need to generate this in your github account global g_token := &#34;74jf8gh7ihdg9orlkk948rjfugnry369jgirn857&#34; ; &lt;-- not a real token, demo purposes ;------------------------------------------------------------------ ;MAIN CODE r := false request := comobjcreate(&#34;WinHttp." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://deciacco.github.io/posts/ahkgithubprivate/" />
<meta property="article:published_time" content="2019-05-06T00:00:00+00:00" />
<meta property="article:modified_time" content="2019-05-06T00:00:00+00:00" />


  </head>
  <body>
    <header class="app-header">
      <h1><a href="https://deciacco.github.io">eugenio c.</a></h1>
      <p class="site-description">my stuff online</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/deciacco" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
      </div>
      <nav >
        
        <ul class="sidebar-nav">
        
          <li><a class="sidebar-nav-item" href="/posts/" title="blog section">Posts</a></li>
        
          <li><a class="sidebar-nav-item" href="/tags/" title="tags section">Tags</a></li>
        
        </ul>
      </nav>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Private GitHub Repo and Autohokey</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          May 6, 2019
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          2 min read
        </div><div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://deciacco.github.io/tags/autohotkey/">Autohotkey</a><a class="tag" href="https://deciacco.github.io/tags/github/">GitHub</a></div></div>
    </header>
    <div class="post-content">
      <p>How to connect to a GitHub Private Repository to download files.</p>

<p>This can be useful if you want to automatically update your application to the latest release.</p>
<div class="highlight"><pre style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-clojure" data-lang="clojure">#<span style="color:#40ffff">SingleInstance</span>, <span style="color:#40ffff">force</span>
#<span style="color:#40ffff">NoEnv</span>

#<span style="color:#40ffff">Include</span> <span style="color:#40ffff">%A_ScriptDir%</span><span style="color:#ed9d13">\.</span><span style="color:#40ffff">.</span><span style="color:#ed9d13">\j</span><span style="color:#40ffff">son</span><span style="color:#ed9d13">\J</span><span style="color:#40ffff">SON.ahk</span> <span style="color:#999;font-style:italic">;https://github.com/cocobelgica/AutoHotkey-JSON</span>

<span style="color:#999;font-style:italic">;------------------------------------------------------------------</span>
<span style="color:#999;font-style:italic">;GLOBALS</span>

<span style="color:#40ffff">global</span> <span style="color:#40ffff">g_url</span> <span style="color:#ed9d13">:=</span> <span style="color:#ed9d13">&#34;https://api.github.com/repos/&lt;username&gt;/&lt;repository&gt;/releases&#34;</span>
<span style="color:#40ffff">global</span> <span style="color:#40ffff">g_file</span> <span style="color:#ed9d13">:=</span> <span style="color:#ed9d13">&#34;filename.zip&#34;</span>
<span style="color:#40ffff">global</span> <span style="color:#40ffff">g_saveto</span> <span style="color:#ed9d13">:=</span> <span style="color:#40ffff">A_Desktop</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;/&#34;</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#40ffff">g_file</span>

<span style="color:#999;font-style:italic">; You need to generate this in your github account</span>
<span style="color:#40ffff">global</span> <span style="color:#40ffff">g_token</span> <span style="color:#ed9d13">:=</span> <span style="color:#ed9d13">&#34;74jf8gh7ihdg9orlkk948rjfugnry369jgirn857&#34;</span> <span style="color:#999;font-style:italic">; &lt;-- not a real token, demo purposes</span>

<span style="color:#999;font-style:italic">;------------------------------------------------------------------</span>
<span style="color:#999;font-style:italic">;MAIN CODE</span>

<span style="color:#40ffff">r</span> <span style="color:#ed9d13">:=</span> <span style="color:#40ffff">false</span>

<span style="color:#40ffff">request</span> <span style="color:#ed9d13">:=</span> <span style="color:#40ffff">comobjcreate</span>(<span style="color:#ed9d13">&#34;WinHttp.WinHttpRequest.5.1&#34;</span>) <span style="color:#999;font-style:italic">; Lets get our &#34;navigator&#34;</span>

<span style="color:#40ffff">request.Open</span>(<span style="color:#ed9d13">&#34;GET&#34;</span>, <span style="color:#40ffff">g_url</span> , <span style="color:#40ffff">false</span>)
<span style="color:#40ffff">request.SetRequestHeader</span>(<span style="color:#ed9d13">&#34;Authorization&#34;</span>, <span style="color:#ed9d13">&#34;token &#34;</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#40ffff">g_token</span>)
<span style="color:#40ffff">request.Send</span>() <span style="color:#999;font-style:italic">; Get the releases information</span>

<span style="color:#6ab825;font-weight:bold">if </span>(<span style="color:#447fcf">request.responsetext</span> <span style="color:#24909d">= </span><span style="color:#ed9d13">&#34;failed&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">||</span> <span style="color:#40ffff">request.status</span> <span style="color:#40ffff">!=</span> <span style="color:#3677a9">200</span> <span style="color:#a61717;background-color:#e3d2d2">||</span> <span style="color:#40ffff">comobjtype</span>(<span style="color:#447fcf">request.responsestream</span>) <span style="color:#40ffff">!=</span> <span style="color:#3677a9">0</span><span style="color:#40ffff">xd</span>) {
      <span style="color:#40ffff">FileAppend</span>, <span style="color:#40ffff">%</span> <span style="color:#ed9d13">&#34;Error:`r`n&#34;</span>
          <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;Status: `r`n&#34;</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#40ffff">request.status</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;`r`n&#34;</span>
          <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;Headers: `r`n&#34;</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#40ffff">request.getallresponseheaders</span>() <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;`r`n&#34;</span>
          <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;Response: `r`n&#34;</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#40ffff">request.responsetext</span>
          <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;`r`n&#34;</span>, <span style="color:#40ffff">*</span>
}
<span style="color:#40ffff">else</span>
{
  <span style="color:#40ffff">jsObj</span> <span style="color:#ed9d13">:=</span> <span style="color:#40ffff">JSON.Load</span>(<span style="color:#447fcf">request.ResponseText</span>) <span style="color:#999;font-style:italic">; Parse the JSON file returned from the GitHub API</span>

  <span style="color:#24909d">for </span><span style="color:#40ffff">index</span>, <span style="color:#40ffff">element</span> <span style="color:#40ffff">in</span> <span style="color:#40ffff">jsObj.1.assets</span>
  {
    <span style="color:#999;font-style:italic">; we need to get a certain file out of all the assets</span>
    <span style="color:#6ab825;font-weight:bold">if </span>(<span style="color:#447fcf">element.name</span> <span style="color:#24909d">= </span><span style="color:#40ffff">g_file</span>) {
      <span style="color:#40ffff">g_url</span> <span style="color:#ed9d13">:=</span> <span style="color:#40ffff">element.url</span>
    }
  }
}

  <span style="color:#40ffff">request.option</span>(<span style="color:#3677a9">6</span>) <span style="color:#ed9d13">:=</span> <span style="color:#3677a9">0</span> <span style="color:#999;font-style:italic">;no redirects</span>
  <span style="color:#40ffff">request.open</span>(<span style="color:#ed9d13">&#34;GET&#34;</span>, <span style="color:#40ffff">g_url</span>, <span style="color:#40ffff">false</span>)
  <span style="color:#40ffff">request.setrequestheader</span>(<span style="color:#ed9d13">&#34;Authorization&#34;</span>, <span style="color:#ed9d13">&#34;token &#34;</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#40ffff">g_token</span>)
  <span style="color:#40ffff">request.setrequestheader</span>(<span style="color:#ed9d13">&#34;Accept&#34;</span>, <span style="color:#ed9d13">&#34;application/octet-stream&#34;</span>)
  <span style="color:#40ffff">request.send</span>() <span style="color:#999;font-style:italic">;FIRST request gets the 302 redirect to AWS</span>

  <span style="color:#6ab825;font-weight:bold">if </span>(<span style="color:#447fcf">request.responsetext</span> <span style="color:#24909d">= </span><span style="color:#ed9d13">&#34;failed&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">||</span> <span style="color:#40ffff">request.status</span> <span style="color:#40ffff">!=</span> <span style="color:#3677a9">302</span> <span style="color:#a61717;background-color:#e3d2d2">||</span> <span style="color:#40ffff">comobjtype</span>(<span style="color:#447fcf">request.responsestream</span>) <span style="color:#40ffff">!=</span> <span style="color:#3677a9">0</span><span style="color:#40ffff">xd</span>) {
      <span style="color:#40ffff">FileAppend</span>, <span style="color:#40ffff">%</span> <span style="color:#ed9d13">&#34;Error:`r`n&#34;</span>
          <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;Status: `r`n&#34;</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#40ffff">request.status</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;`r`n&#34;</span>
          <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;Headers: `r`n&#34;</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#40ffff">request.getallresponseheaders</span>() <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;`r`n&#34;</span>
          <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;Response: `r`n&#34;</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#40ffff">request.responsetext</span>
          <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;`r`n&#34;</span>, <span style="color:#40ffff">*</span>
  }
  <span style="color:#40ffff">else</span>
  {
    <span style="color:#40ffff">g_url</span> <span style="color:#ed9d13">:=</span> <span style="color:#40ffff">request.getresponseheader</span>(<span style="color:#ed9d13">&#34;Location&#34;</span>) <span style="color:#999;font-style:italic">;get the redirect URL</span>

    <span style="color:#40ffff">request.open</span>(<span style="color:#ed9d13">&#34;GET&#34;</span>, <span style="color:#40ffff">g_url</span>, <span style="color:#40ffff">false</span>)
    <span style="color:#40ffff">request.send</span>() <span style="color:#999;font-style:italic">;SECOND request gets the file to download</span>

    <span style="color:#6ab825;font-weight:bold">if </span>(<span style="color:#447fcf">request.responsetext</span> <span style="color:#24909d">= </span><span style="color:#ed9d13">&#34;failed&#34;</span> <span style="color:#a61717;background-color:#e3d2d2">||</span> <span style="color:#40ffff">request.status</span> <span style="color:#40ffff">!=</span> <span style="color:#3677a9">200</span> <span style="color:#a61717;background-color:#e3d2d2">||</span> <span style="color:#40ffff">comobjtype</span>(<span style="color:#447fcf">request.responsestream</span>) <span style="color:#40ffff">!=</span> <span style="color:#3677a9">0</span><span style="color:#40ffff">xd</span>) {
        <span style="color:#40ffff">FileAppend</span>, <span style="color:#40ffff">%</span> <span style="color:#ed9d13">&#34;Error:`r`n&#34;</span>
            <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;Status: `r`n&#34;</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#40ffff">request.status</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;`r`n&#34;</span>
            <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;Headers: `r`n&#34;</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#40ffff">request.getallresponseheaders</span>() <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;`r`n&#34;</span>
            <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;Response: `r`n&#34;</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#40ffff">request.responsetext</span>
            <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;`r`n&#34;</span>, <span style="color:#40ffff">*</span>
    }
    <span style="color:#40ffff">else</span>
    {
        <span style="color:#40ffff">g_url</span> <span style="color:#ed9d13">:=</span> <span style="color:#40ffff">request.getresponseheader</span>(<span style="color:#ed9d13">&#34;Content-Length&#34;</span>)

        <span style="color:#40ffff">URLDownloadToFile</span>, <span style="color:#40ffff">%</span> <span style="color:#40ffff">g_url</span>, <span style="color:#40ffff">%</span> <span style="color:#40ffff">g_saveto</span> <span style="color:#999;font-style:italic">; download the file</span>

        <span style="color:#6ab825;font-weight:bold">if </span>(<span style="color:#447fcf">ErrorLevel</span> <span style="color:#24909d">= </span><span style="color:#3677a9">1</span>) {
            <span style="color:#40ffff">FileAppend</span>, <span style="color:#40ffff">%</span> <span style="color:#40ffff">splash_msg_prog</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;Download Failed...&#34;</span>
        } <span style="color:#40ffff">else</span> {
            <span style="color:#40ffff">FileAppend</span>, <span style="color:#40ffff">%</span> <span style="color:#40ffff">splash_msg_prog</span> <span style="color:#6ab825;font-weight:bold">. </span><span style="color:#ed9d13">&#34;File downloaded!&#34;</span>
        }

        <span style="color:#40ffff">FileAppend</span>, <span style="color:#40ffff">%</span> <span style="color:#ed9d13">&#34;Done!`r`n&#34;</span>, <span style="color:#40ffff">*</span>
    }
  }
}
<span style="color:#40ffff">return</span></code></pre></div>
    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
