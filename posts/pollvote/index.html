<!doctype html>
<html lang="en-us">
  <head>
    <title>Poll Voter // deciacco</title>
    <meta charset="utf-8" />
    <meta name="generator" content="Hugo 0.102.3" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="author" content="eugenio c." />
    <meta name="description" content="" />
    <link rel="stylesheet" href="https://deciacco.github.io/css/main.min.e0a740700d179dfcce46daf97c59dd99be917ec764b052d3f8e89ec6f03fcdc4.css" />

    
    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Poll Voter"/>
<meta name="twitter:description" content="Poll Voter is a &ldquo;Bot&rdquo; that automatically votes for a certain, user specified option on an online poll artificially changing the results.
The original code is below with the refactored version in OOP.
Poll Vote Code #!/usr/bin/env python3 # Load libraries import logging import random import datetime import os import sys import time import json import requests from torpy import TorClient from torpy.http.adapter import TorHttpAdapter from bs4 import BeautifulSoup as BeaSoup # Constants RETRIES = 3 OWNP = os."/>

    <meta property="og:title" content="Poll Voter" />
<meta property="og:description" content="Poll Voter is a &ldquo;Bot&rdquo; that automatically votes for a certain, user specified option on an online poll artificially changing the results.
The original code is below with the refactored version in OOP.
Poll Vote Code #!/usr/bin/env python3 # Load libraries import logging import random import datetime import os import sys import time import json import requests from torpy import TorClient from torpy.http.adapter import TorHttpAdapter from bs4 import BeautifulSoup as BeaSoup # Constants RETRIES = 3 OWNP = os." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://deciacco.github.io/posts/pollvote/" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2020-11-15T00:00:00+00:00" />
<meta property="article:modified_time" content="2020-11-15T00:00:00+00:00" />



  </head>
  <body>
    <header class="app-header">
      <h1><a href="https://deciacco.github.io">eugenio c.</a></h1>
      <p class="site-description">my stuff online</p>
      <div class="app-header-social">
        
          <a target="_blank" href="https://github.com/deciacco" rel="noreferrer noopener"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-github">
  <title>github</title>
  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 0 0-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0 0 20 4.77 5.07 5.07 0 0 0 19.91 1S18.73.65 16 2.48a13.38 13.38 0 0 0-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 0 0 5 4.77a5.44 5.44 0 0 0-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 0 0 9 18.13V22"></path>
</svg></a>
        
      </div>
      <nav >
        
        <ul class="sidebar-nav">
        
          <li><a class="sidebar-nav-item" href="/posts/" title="blog section">Posts</a></li>
        
          <li><a class="sidebar-nav-item" href="/tags/" title="tags section">Tags</a></li>
        
        </ul>
      </nav>
    </header>
    <main class="app-container">
      
  <article class="post">
    <header class="post-header">
      <h1 class ="post-title">Poll Voter</h1>
      <div class="post-meta">
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-calendar">
  <title>calendar</title>
  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect><line x1="16" y1="2" x2="16" y2="6"></line><line x1="8" y1="2" x2="8" y2="6"></line><line x1="3" y1="10" x2="21" y2="10"></line>
</svg>
          Nov 15, 2020
        </div>
        <div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-clock">
  <title>clock</title>
  <circle cx="12" cy="12" r="10"></circle><polyline points="12 6 12 12 16 14"></polyline>
</svg>
          7 min read
        </div><div>
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="icon icon-tag">
  <title>tag</title>
  <path d="M20.59 13.41l-7.17 7.17a2 2 0 0 1-2.83 0L2 12V2h10l8.59 8.59a2 2 0 0 1 0 2.82z"></path><line x1="7" y1="7" x2="7" y2="7"></line>
</svg>
          <a class="tag" href="https://deciacco.github.io/tags/python/">Python</a><a class="tag" href="https://deciacco.github.io/tags/hacking/">Hacking</a></div></div>
    </header>
    <div class="post-content">
      <p>Poll Voter is a &ldquo;Bot&rdquo; that automatically votes for a certain, user specified option on an online poll artificially changing the results.</p>
<p>The original code is below with the refactored version in OOP.</p>
<h2 id="poll-vote-code">Poll Vote Code</h2>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999;font-style:italic">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Load libraries</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">logging</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">random</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">datetime</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">os</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">sys</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">time</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">json</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">requests</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">from</span> <span style="color:#447fcf;text-decoration:underline">torpy</span> <span style="color:#6ab825;font-weight:bold">import</span> TorClient
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">from</span> <span style="color:#447fcf;text-decoration:underline">torpy.http.adapter</span> <span style="color:#6ab825;font-weight:bold">import</span> TorHttpAdapter
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">from</span> <span style="color:#447fcf;text-decoration:underline">bs4</span> <span style="color:#6ab825;font-weight:bold">import</span> BeautifulSoup <span style="color:#6ab825;font-weight:bold">as</span> BeaSoup
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Constants</span>
</span></span><span style="display:flex;"><span>RETRIES = <span style="color:#3677a9">3</span>
</span></span><span style="display:flex;"><span>OWNP = os.path.abspath(os.path.dirname(sys.argv[<span style="color:#3677a9">0</span>]))
</span></span><span style="display:flex;"><span>LOGFILE = <span style="color:#ed9d13">&#39;/media/sf_data/scriptsout/vote/vote.txt&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Setup Logging</span>
</span></span><span style="display:flex;"><span>logging.basicConfig(
</span></span><span style="display:flex;"><span>    <span style="color:#24909d">format</span>=<span style="color:#ed9d13">&#39;</span><span style="color:#ed9d13">%(asctime)s</span><span style="color:#ed9d13">:</span><span style="color:#ed9d13">%(levelname)s</span><span style="color:#ed9d13">:</span><span style="color:#ed9d13">%(message)s</span><span style="color:#ed9d13">&#39;</span>,
</span></span><span style="display:flex;"><span>    level=logging.INFO,
</span></span><span style="display:flex;"><span>    filename=LOGFILE)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Storage for the useragent strings from file</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic">#   facilitates picking at random</span>
</span></span><span style="display:flex;"><span>useragents = []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Make it look like a real browser</span>
</span></span><span style="display:flex;"><span>headers = {
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;Accept&#34;</span>: <span style="color:#ed9d13">&#34;text/html,application/xhtml+xml,application/xml; </span><span style="color:#ed9d13">\
</span></span></span><span style="display:flex;"><span><span style="color:#ed9d13"></span><span style="color:#ed9d13">        q=0.9,image/webp,*/*;q=0.8&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;Accept-Encoding&#34;</span>: <span style="color:#ed9d13">&#34;gzip, deflate, br&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;Accept-Language&#34;</span>: <span style="color:#ed9d13">&#34;en-US,en;q=0.5&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;DNT&#34;</span>: <span style="color:#ed9d13">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;Host&#34;</span>: <span style="color:#ed9d13">&#34;&#34;</span>, <span style="color:#999;font-style:italic"># set at runtime</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;Upgrade-Insecure-Requests&#34;</span>: <span style="color:#ed9d13">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;User-Agent&#34;</span>: <span style="color:#ed9d13">&#34;&#34;</span>, <span style="color:#999;font-style:italic"># set at runtime</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;Cache-Control&#34;</span>: <span style="color:#ed9d13">&#34;max-age=0&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;Connection&#34;</span>: <span style="color:#ed9d13">&#34;keep-alive&#34;</span>
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>poll_id = <span style="color:#ed9d13">&#34;10614272&#34;</span> <span style="color:#999;font-style:italic"># change for a different poll</span>
</span></span><span style="display:flex;"><span>poll_winner = <span style="color:#ed9d13">&#34;49167224&#34;</span> <span style="color:#999;font-style:italic"># which item to vote for | 49167240, 49167239, 49167224</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Poll base url</span>
</span></span><span style="display:flex;"><span>url_poll = (
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;https://poll.fm/&#34;</span>
</span></span><span style="display:flex;"><span>    + poll_id
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Generated URL to be submited for vote</span>
</span></span><span style="display:flex;"><span>url_template = (
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;https://poll.fm/vote?&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;va=</span><span style="color:#ed9d13">{item_va}</span><span style="color:#ed9d13">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;&amp;pt=0&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;&amp;r=</span><span style="color:#ed9d13">{item_r}</span><span style="color:#ed9d13">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;&amp;p=&#34;</span> + poll_id +
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;&amp;a=&#34;</span> + poll_winner + <span style="color:#ed9d13">&#34;,&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;&amp;o=&#34;</span>  <span style="color:#999;font-style:italic"># nothing needed here</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;&amp;t=</span><span style="color:#ed9d13">{item_t}</span><span style="color:#ed9d13">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;&amp;token=</span><span style="color:#ed9d13">{item_token}</span><span style="color:#ed9d13">&#34;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#ed9d13">&#34;&amp;pz=</span><span style="color:#ed9d13">{item_pz}</span><span style="color:#ed9d13">&#34;</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># *****************************************************************************</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Helper Functions</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># *****************************************************************************</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Loads the user agents from file into the array</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">def</span> <span style="color:#447fcf">get_useragents</span>():
</span></span><span style="display:flex;"><span>    logging.info(<span style="color:#ed9d13">&#34;Loading useragent strings&#34;</span>)
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">with</span> <span style="color:#24909d">open</span>(OWNP + <span style="color:#ed9d13">&#39;/useragent.txt&#39;</span>, <span style="color:#ed9d13">&#39;r&#39;</span>) <span style="color:#6ab825;font-weight:bold">as</span> f:
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">for</span> line <span style="color:#6ab825;font-weight:bold">in</span> f:
</span></span><span style="display:flex;"><span>            useragents.append(line.rstrip(<span style="color:#ed9d13">&#39;</span><span style="color:#ed9d13">\n</span><span style="color:#ed9d13">&#39;</span>).rstrip(<span style="color:#ed9d13">&#39;</span><span style="color:#ed9d13">\r</span><span style="color:#ed9d13">&#39;</span>))    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># *****************************************************************************</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Main Function</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># *****************************************************************************</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">def</span> <span style="color:#447fcf">main</span>():
</span></span><span style="display:flex;"><span>    getdata = <span style="color:#6ab825;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>        get_useragents() <span style="color:#999;font-style:italic"># Load user agents</span>
</span></span><span style="display:flex;"><span>        headers[<span style="color:#ed9d13">&#34;Host&#34;</span>] = <span style="color:#ed9d13">&#34;poll.fm&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">while</span> getdata: <span style="color:#999;font-style:italic"># Loop until there is a problem</span>
</span></span><span style="display:flex;"><span>            tor = TorClient() <span style="color:#999;font-style:italic"># Let&#39;s use Tor, shall we....</span>
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#6ab825;font-weight:bold">with</span> tor.get_guard() <span style="color:#6ab825;font-weight:bold">as</span> guard:
</span></span><span style="display:flex;"><span>                adapter = TorHttpAdapter(guard, <span style="color:#3677a9">3</span>, retries=RETRIES)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#6ab825;font-weight:bold">with</span> requests.Session() <span style="color:#6ab825;font-weight:bold">as</span> s:
</span></span><span style="display:flex;"><span>                    s.mount(<span style="color:#ed9d13">&#39;http://&#39;</span>, adapter)
</span></span><span style="display:flex;"><span>                    s.mount(<span style="color:#ed9d13">&#39;https://&#39;</span>, adapter)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Make it look like a different browser randomly</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic">#   by changing the user-agent with every request</span>
</span></span><span style="display:flex;"><span>                    line_no = random.randint(<span style="color:#3677a9">0</span>, <span style="color:#24909d">len</span>(useragents)-<span style="color:#3677a9">1</span>)
</span></span><span style="display:flex;"><span>                    cur_useragent = useragents[line_no]
</span></span><span style="display:flex;"><span>                    headers[<span style="color:#ed9d13">&#34;User-Agent&#34;</span>] = cur_useragent
</span></span><span style="display:flex;"><span>                    logging.info(<span style="color:#ed9d13">&#34;User-Agent set to: </span><span style="color:#ed9d13">%s</span><span style="color:#ed9d13">&#34;</span> % cur_useragent)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Go to poll main page to get the needed items</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic">#   to submit for the vote</span>
</span></span><span style="display:flex;"><span>                    logging.info(<span style="color:#ed9d13">&#34;Getting: </span><span style="color:#ed9d13">%s</span><span style="color:#ed9d13">&#34;</span> % url_poll)
</span></span><span style="display:flex;"><span>                    r = s.get(url_poll, headers=headers)
</span></span><span style="display:flex;"><span>                    logging.info(
</span></span><span style="display:flex;"><span>                            <span style="color:#ed9d13">&#34;First response: </span><span style="color:#ed9d13">%s</span><span style="color:#ed9d13">&#34;</span> 
</span></span><span style="display:flex;"><span>                            % r.status_code 
</span></span><span style="display:flex;"><span>                            + <span style="color:#ed9d13">&#34; &#34;</span> 
</span></span><span style="display:flex;"><span>                            + r.url
</span></span><span style="display:flex;"><span>                        )
</span></span><span style="display:flex;"><span>                    r.raise_for_status()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Get the html from the web page</span>
</span></span><span style="display:flex;"><span>                    bs_content = BeaSoup(r.content, <span style="color:#ed9d13">&#34;lxml&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Get the info from the Vote button json object</span>
</span></span><span style="display:flex;"><span>                    button_data = bs_content.find(<span style="color:#ed9d13">&#39;a&#39;</span>, 
</span></span><span style="display:flex;"><span>                        class_=<span style="color:#ed9d13">&#34;vote-button css-vote-button pds-vote-button&#34;</span>)
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    v_bdata = button_data.attrs.get(<span style="color:#ed9d13">&#39;data-vote&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Load as json data</span>
</span></span><span style="display:flex;"><span>                    bdata = json.loads(v_bdata)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Get hidden form value</span>
</span></span><span style="display:flex;"><span>                    v_pz = bs_content.find(attrs={<span style="color:#ed9d13">&#34;name&#34;</span>: <span style="color:#ed9d13">&#34;pz&#34;</span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Inject data into vote URL template</span>
</span></span><span style="display:flex;"><span>                    url_vote = url_template  <span style="color:#999;font-style:italic"># reset url_vote</span>
</span></span><span style="display:flex;"><span>                    url_vote = url_vote.replace(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">{item_t}</span><span style="color:#ed9d13">&#34;</span>, <span style="color:#24909d">str</span>(bdata[<span style="color:#ed9d13">&#39;t&#39;</span>]))
</span></span><span style="display:flex;"><span>                    url_vote = url_vote.replace(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">{item_token}</span><span style="color:#ed9d13">&#34;</span>, <span style="color:#24909d">str</span>(bdata[<span style="color:#ed9d13">&#39;n&#39;</span>]))
</span></span><span style="display:flex;"><span>                    url_vote = url_vote.replace(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">{item_pz}</span><span style="color:#ed9d13">&#34;</span>, <span style="color:#24909d">str</span>(v_pz[<span style="color:#ed9d13">&#39;value&#39;</span>]))
</span></span><span style="display:flex;"><span>                    url_vote = url_vote.replace(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">{item_r}</span><span style="color:#ed9d13">&#34;</span>, <span style="color:#24909d">str</span>(bdata[<span style="color:#ed9d13">&#39;b&#39;</span>]))
</span></span><span style="display:flex;"><span>                    url_vote = url_vote.replace(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">{item_va}</span><span style="color:#ed9d13">&#34;</span>, <span style="color:#24909d">str</span>(bdata[<span style="color:#ed9d13">&#39;at&#39;</span>]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Makes it look slightly more authentic, by waiting </span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic">#  before actually submitting the vote after the</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic">#  initial request to the poll.</span>
</span></span><span style="display:flex;"><span>                    logging.info(<span style="color:#ed9d13">&#34;Waiting 2 seconds before submitting.&#34;</span>)
</span></span><span style="display:flex;"><span>                    time.sleep(<span style="color:#3677a9">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Let&#39;s vote!</span>
</span></span><span style="display:flex;"><span>                    logging.info(<span style="color:#ed9d13">&#34;Getting: </span><span style="color:#ed9d13">%s</span><span style="color:#ed9d13">&#34;</span> % url_vote)
</span></span><span style="display:flex;"><span>                    r = s.get(url_vote, headers=headers)
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Redirected response, log it</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#6ab825;font-weight:bold">if</span> r.history:
</span></span><span style="display:flex;"><span>                        logging.info(<span style="color:#ed9d13">&#34;Request redirected&#34;</span>)
</span></span><span style="display:flex;"><span>                        <span style="color:#6ab825;font-weight:bold">for</span> resp <span style="color:#6ab825;font-weight:bold">in</span> r.history:
</span></span><span style="display:flex;"><span>                            logging.info(
</span></span><span style="display:flex;"><span>                                <span style="color:#ed9d13">&#34;Redirected response: </span><span style="color:#ed9d13">%s</span><span style="color:#ed9d13">&#34;</span> 
</span></span><span style="display:flex;"><span>                                % resp.status_code 
</span></span><span style="display:flex;"><span>                                + <span style="color:#ed9d13">&#34; &#34;</span> 
</span></span><span style="display:flex;"><span>                                + resp.url
</span></span><span style="display:flex;"><span>                            )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    logging.info(
</span></span><span style="display:flex;"><span>                            <span style="color:#ed9d13">&#34;Final destination: </span><span style="color:#ed9d13">%s</span><span style="color:#ed9d13">&#34;</span> 
</span></span><span style="display:flex;"><span>                            % r.status_code 
</span></span><span style="display:flex;"><span>                            + <span style="color:#ed9d13">&#34; &#34;</span> 
</span></span><span style="display:flex;"><span>                            + r.url
</span></span><span style="display:flex;"><span>                        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    r.raise_for_status()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Wait a random number of seconds between 5 &amp; 20</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic">#  before starting again - more realistic</span>
</span></span><span style="display:flex;"><span>                    wait_time = random.randint(<span style="color:#3677a9">5</span>, <span style="color:#3677a9">20</span>)
</span></span><span style="display:flex;"><span>                    logging.info(<span style="color:#ed9d13">&#34;Waiting </span><span style="color:#ed9d13">%i</span><span style="color:#ed9d13"> seconds.&#34;</span> % (wait_time))
</span></span><span style="display:flex;"><span>                    time.sleep(wait_time)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-style:italic"># Any issues, log them and get out.</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">except</span> <span style="color:#bbb">Exception</span> <span style="color:#6ab825;font-weight:bold">as</span> e:
</span></span><span style="display:flex;"><span>        logging.error(e)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># Exit loop</span>
</span></span><span style="display:flex;"><span>        getdata = <span style="color:#6ab825;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># *****************************************************************************</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Script Starting Point</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># *****************************************************************************</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">if</span> __name__ == <span style="color:#ed9d13">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><h2 id="poll-vote-code-oop">Poll Vote Code (OOP)</h2>
<h3 id="main-votepy">Main (vote.py)</h3>
<ul>
<li>Main entry point/start of program</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999;font-style:italic">#!/usr/bin/env python3</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Load libraries</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">logging</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">from</span> <span style="color:#447fcf;text-decoration:underline">voting</span> <span style="color:#6ab825;font-weight:bold">import</span> PollFMVoter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>LOGFILE = <span style="color:#ed9d13">&#39;/media/sf_data/scriptsout/vote/vote.txt&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Setup Logging</span>
</span></span><span style="display:flex;"><span>logging.basicConfig(
</span></span><span style="display:flex;"><span>    <span style="color:#24909d">format</span>=<span style="color:#ed9d13">&#39;</span><span style="color:#ed9d13">%(asctime)s</span><span style="color:#ed9d13">:</span><span style="color:#ed9d13">%(levelname)s</span><span style="color:#ed9d13">:</span><span style="color:#ed9d13">%(message)s</span><span style="color:#ed9d13">&#39;</span>,
</span></span><span style="display:flex;"><span>    level=logging.INFO,
</span></span><span style="display:flex;"><span>    filename=LOGFILE)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># *****************************************************************************</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Main Function</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># *****************************************************************************</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">def</span> <span style="color:#447fcf">main</span>():
</span></span><span style="display:flex;"><span>    myvtr = PollFMVoter()
</span></span><span style="display:flex;"><span>    myvtr.poll_id = <span style="color:#ed9d13">&#34;10614272&#34;</span>
</span></span><span style="display:flex;"><span>    myvtr.poll_option = <span style="color:#ed9d13">&#34;49167239&#34;</span>
</span></span><span style="display:flex;"><span>    myvtr.getVotes()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># *****************************************************************************</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Script Starting Point</span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># *****************************************************************************</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">if</span> __name__ == <span style="color:#ed9d13">&#34;__main__&#34;</span>:
</span></span><span style="display:flex;"><span>    main()
</span></span></code></pre></div><h3 id="autovoter-voterpy">AutoVoter (voter.py)</h3>
<ul>
<li>&ldquo;Generic&rdquo; Class to inherit from with common code.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Load libraries</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">logging</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">random</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">os</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">sys</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">from</span> <span style="color:#447fcf;text-decoration:underline">abc</span> <span style="color:#6ab825;font-weight:bold">import</span> abstractmethod, abstractproperty
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Constants</span>
</span></span><span style="display:flex;"><span>OWNP = os.path.abspath(os.path.dirname(sys.argv[<span style="color:#3677a9">0</span>]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logger = logging.getLogger(__name__)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">AutoVoter</span>:
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        self._useragents = []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self._url_poll = <span style="color:#ed9d13">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        self._url_template = <span style="color:#ed9d13">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># Make it look like a real browser</span>
</span></span><span style="display:flex;"><span>        self._headers = {
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;Accept&#34;</span>: <span style="color:#ed9d13">&#34;text/html,application/xhtml+xml,application/xml; </span><span style="color:#ed9d13">\
</span></span></span><span style="display:flex;"><span><span style="color:#ed9d13"></span><span style="color:#ed9d13">                q=0.9,image/webp,*/*;q=0.8&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;Accept-Encoding&#34;</span>: <span style="color:#ed9d13">&#34;gzip, deflate, br&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;Accept-Language&#34;</span>: <span style="color:#ed9d13">&#34;en-US,en;q=0.5&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;DNT&#34;</span>: <span style="color:#ed9d13">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;Host&#34;</span>: <span style="color:#ed9d13">&#34;&#34;</span>, <span style="color:#999;font-style:italic"># set at runtime</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;Upgrade-Insecure-Requests&#34;</span>: <span style="color:#ed9d13">&#34;1&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;User-Agent&#34;</span>: <span style="color:#ed9d13">&#34;&#34;</span>, <span style="color:#999;font-style:italic"># set at runtime</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;Cache-Control&#34;</span>: <span style="color:#ed9d13">&#34;max-age=0&#34;</span>,
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;Connection&#34;</span>: <span style="color:#ed9d13">&#34;keep-alive&#34;</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self.__get_useragents()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-style:italic"># Loads a new, random user-agent string   </span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">def</span> <span style="color:#447fcf">_set_useragent</span>(self):
</span></span><span style="display:flex;"><span>        line_no = random.randint(<span style="color:#3677a9">0</span>, <span style="color:#24909d">len</span>(self._useragents)-<span style="color:#3677a9">1</span>)
</span></span><span style="display:flex;"><span>        logger.info(<span style="color:#ed9d13">&#34;User-agent set as: </span><span style="color:#ed9d13">%s</span><span style="color:#ed9d13">&#34;</span> % self._useragents[line_no]) 
</span></span><span style="display:flex;"><span>        self._headers[<span style="color:#ed9d13">&#34;User-Agent&#34;</span>] = self._useragents[line_no]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#999;font-style:italic"># Loads the user agents from file into the array</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">def</span> <span style="color:#447fcf">__get_useragents</span>(self):
</span></span><span style="display:flex;"><span>        logger.info(<span style="color:#ed9d13">&#34;Loading useragent strings&#34;</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">with</span> <span style="color:#24909d">open</span>(OWNP + <span style="color:#ed9d13">&#39;/voting/useragent.txt&#39;</span>, <span style="color:#ed9d13">&#39;r&#39;</span>) <span style="color:#6ab825;font-weight:bold">as</span> f:
</span></span><span style="display:flex;"><span>            <span style="color:#6ab825;font-weight:bold">for</span> line <span style="color:#6ab825;font-weight:bold">in</span> f:
</span></span><span style="display:flex;"><span>                self._useragents.append(line.rstrip(<span style="color:#ed9d13">&#39;</span><span style="color:#ed9d13">\n</span><span style="color:#ed9d13">&#39;</span>).rstrip(<span style="color:#ed9d13">&#39;</span><span style="color:#ed9d13">\r</span><span style="color:#ed9d13">&#39;</span>)) 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ffa500">@abstractmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">def</span> <span style="color:#447fcf">__getVote</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">pass</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#ffa500">@abstractmethod</span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">def</span> <span style="color:#447fcf">getVotes</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">pass</span>
</span></span></code></pre></div><h3 id="pollfmvoter-pollfmpy">PollFMVoter (pollfm.py)</h3>
<ul>
<li>More specific class, inherits from AutoVoter and implements specifics.</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#d0d0d0;background-color:#202020;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-python" data-lang="python"><span style="display:flex;"><span><span style="color:#999;font-style:italic"># Load libraries</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">logging</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">random</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">time</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">json</span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">import</span> <span style="color:#447fcf;text-decoration:underline">requests</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">from</span> <span style="color:#447fcf;text-decoration:underline">torpy</span> <span style="color:#6ab825;font-weight:bold">import</span> TorClient
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">from</span> <span style="color:#447fcf;text-decoration:underline">torpy.http.adapter</span> <span style="color:#6ab825;font-weight:bold">import</span> TorHttpAdapter
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">from</span> <span style="color:#447fcf;text-decoration:underline">bs4</span> <span style="color:#6ab825;font-weight:bold">import</span> BeautifulSoup <span style="color:#6ab825;font-weight:bold">as</span> BeaSoup
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">from</span> <span style="color:#447fcf;text-decoration:underline">voting.voter</span> <span style="color:#6ab825;font-weight:bold">import</span> AutoVoter
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>logger = logging.getLogger(__name__)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#6ab825;font-weight:bold">class</span> <span style="color:#447fcf;text-decoration:underline">PollFMVoter</span>(AutoVoter):
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">def</span> __init__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#24909d">super</span>().__init__()
</span></span><span style="display:flex;"><span>        self._headers[<span style="color:#ed9d13">&#34;Host&#34;</span>] = <span style="color:#ed9d13">&#34;poll.fm&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self.poll_id = <span style="color:#ed9d13">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        self.poll_option = <span style="color:#ed9d13">&#34;&#34;</span>
</span></span><span style="display:flex;"><span>        self.poll_votes = <span style="color:#3677a9">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        self.__vote_pointer = <span style="color:#3677a9">0</span>
</span></span><span style="display:flex;"><span>        self.__retries = <span style="color:#3677a9">3</span>
</span></span><span style="display:flex;"><span>        self.__url_poll = <span style="color:#ed9d13">&#34;https://poll.fm/</span><span style="color:#ed9d13">{poll_id}</span><span style="color:#ed9d13">&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># Generated URL to be submited for vote</span>
</span></span><span style="display:flex;"><span>        self.__url_template = (
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;https://poll.fm/vote?&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;va=</span><span style="color:#ed9d13">{item_va}</span><span style="color:#ed9d13">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;&amp;pt=0&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;&amp;r=</span><span style="color:#ed9d13">{item_r}</span><span style="color:#ed9d13">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;&amp;p=</span><span style="color:#ed9d13">{item_pid}</span><span style="color:#ed9d13">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;&amp;a=</span><span style="color:#ed9d13">{item_opt}</span><span style="color:#ed9d13">,&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;&amp;o=&#34;</span>  <span style="color:#999;font-style:italic"># nothing needed here</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;&amp;t=</span><span style="color:#ed9d13">{item_t}</span><span style="color:#ed9d13">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;&amp;token=</span><span style="color:#ed9d13">{item_token}</span><span style="color:#ed9d13">&#34;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#ed9d13">&#34;&amp;pz=</span><span style="color:#ed9d13">{item_pz}</span><span style="color:#ed9d13">&#34;</span>
</span></span><span style="display:flex;"><span>        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">def</span> <span style="color:#447fcf">__getVote</span>(self):
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>            self.__vote_pointer += <span style="color:#3677a9">1</span>
</span></span><span style="display:flex;"><span>            tor = TorClient()
</span></span><span style="display:flex;"><span>                
</span></span><span style="display:flex;"><span>            <span style="color:#6ab825;font-weight:bold">with</span> tor.get_guard() <span style="color:#6ab825;font-weight:bold">as</span> guard:
</span></span><span style="display:flex;"><span>                adapter = TorHttpAdapter(guard, <span style="color:#3677a9">3</span>, retries=self.__retries)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                <span style="color:#6ab825;font-weight:bold">with</span> requests.Session() <span style="color:#6ab825;font-weight:bold">as</span> s:
</span></span><span style="display:flex;"><span>                    s.mount(<span style="color:#ed9d13">&#39;http://&#39;</span>, adapter)
</span></span><span style="display:flex;"><span>                    s.mount(<span style="color:#ed9d13">&#39;https://&#39;</span>, adapter)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Make it look like a different browser randomly</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic">#   by changing the user-agent with every request</span>
</span></span><span style="display:flex;"><span>                    self._set_useragent()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Set the poll id in the url</span>
</span></span><span style="display:flex;"><span>                    self.__url_poll = self.__url_poll.replace(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">{poll_id}</span><span style="color:#ed9d13">&#34;</span>, self.poll_id)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Go to poll main page to get the needed items</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic">#   to submit for the vote</span>
</span></span><span style="display:flex;"><span>                    logger.info(<span style="color:#ed9d13">&#34;Getting: </span><span style="color:#ed9d13">%s</span><span style="color:#ed9d13">&#34;</span> % self.__url_poll)
</span></span><span style="display:flex;"><span>                    r = s.get(self.__url_poll, headers=self._headers)
</span></span><span style="display:flex;"><span>                    logger.info(
</span></span><span style="display:flex;"><span>                            <span style="color:#ed9d13">&#34;First response: </span><span style="color:#ed9d13">%s</span><span style="color:#ed9d13">&#34;</span> 
</span></span><span style="display:flex;"><span>                            % r.status_code 
</span></span><span style="display:flex;"><span>                            + <span style="color:#ed9d13">&#34; &#34;</span> 
</span></span><span style="display:flex;"><span>                            + r.url
</span></span><span style="display:flex;"><span>                        )
</span></span><span style="display:flex;"><span>                    r.raise_for_status()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Get the html from the web page</span>
</span></span><span style="display:flex;"><span>                    bs_content = BeaSoup(r.content, <span style="color:#ed9d13">&#34;lxml&#34;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Get the info from the Vote button json object</span>
</span></span><span style="display:flex;"><span>                    button_data = bs_content.find(<span style="color:#ed9d13">&#39;a&#39;</span>, 
</span></span><span style="display:flex;"><span>                        class_=<span style="color:#ed9d13">&#34;vote-button css-vote-button pds-vote-button&#34;</span>)
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    v_bdata = button_data.attrs.get(<span style="color:#ed9d13">&#39;data-vote&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Load as json data</span>
</span></span><span style="display:flex;"><span>                    bdata = json.loads(v_bdata)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Get hidden form value</span>
</span></span><span style="display:flex;"><span>                    v_pz = bs_content.find(attrs={<span style="color:#ed9d13">&#34;name&#34;</span>: <span style="color:#ed9d13">&#34;pz&#34;</span>})
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Inject data into vote URL template</span>
</span></span><span style="display:flex;"><span>                    url_vote = self.__url_template  <span style="color:#999;font-style:italic"># reset url_vote</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    url_vote = url_vote.replace(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">{item_pid}</span><span style="color:#ed9d13">&#34;</span>, self.poll_id)
</span></span><span style="display:flex;"><span>                    url_vote = url_vote.replace(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">{item_opt}</span><span style="color:#ed9d13">&#34;</span>, self.poll_option)
</span></span><span style="display:flex;"><span>                    url_vote = url_vote.replace(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">{item_t}</span><span style="color:#ed9d13">&#34;</span>, <span style="color:#24909d">str</span>(bdata[<span style="color:#ed9d13">&#39;t&#39;</span>]))
</span></span><span style="display:flex;"><span>                    url_vote = url_vote.replace(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">{item_token}</span><span style="color:#ed9d13">&#34;</span>, <span style="color:#24909d">str</span>(bdata[<span style="color:#ed9d13">&#39;n&#39;</span>]))
</span></span><span style="display:flex;"><span>                    url_vote = url_vote.replace(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">{item_pz}</span><span style="color:#ed9d13">&#34;</span>, <span style="color:#24909d">str</span>(v_pz[<span style="color:#ed9d13">&#39;value&#39;</span>]))
</span></span><span style="display:flex;"><span>                    url_vote = url_vote.replace(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">{item_r}</span><span style="color:#ed9d13">&#34;</span>, <span style="color:#24909d">str</span>(bdata[<span style="color:#ed9d13">&#39;b&#39;</span>]))
</span></span><span style="display:flex;"><span>                    url_vote = url_vote.replace(<span style="color:#ed9d13">&#34;</span><span style="color:#ed9d13">{item_va}</span><span style="color:#ed9d13">&#34;</span>, <span style="color:#24909d">str</span>(bdata[<span style="color:#ed9d13">&#39;at&#39;</span>]))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Makes it look slightly more authentic, by waiting </span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic">#  before actually submitting the vote after the</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic">#  initial request to the poll.</span>
</span></span><span style="display:flex;"><span>                    logger.info(<span style="color:#ed9d13">&#34;Waiting 2 seconds before submitting.&#34;</span>)
</span></span><span style="display:flex;"><span>                    time.sleep(<span style="color:#3677a9">2</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Let&#39;s vote!</span>
</span></span><span style="display:flex;"><span>                    logger.info(<span style="color:#ed9d13">&#34;Submitting vote </span><span style="color:#ed9d13">%i</span><span style="color:#ed9d13">: </span><span style="color:#ed9d13">%s</span><span style="color:#ed9d13">&#34;</span> 
</span></span><span style="display:flex;"><span>                                    % (self.__vote_pointer, url_vote))
</span></span><span style="display:flex;"><span>                    r = s.get(url_vote, headers=self._headers)
</span></span><span style="display:flex;"><span>                    
</span></span><span style="display:flex;"><span>                    <span style="color:#999;font-style:italic"># Redirected response, log it</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#6ab825;font-weight:bold">if</span> r.history:
</span></span><span style="display:flex;"><span>                        logger.info(<span style="color:#ed9d13">&#34;Request redirected&#34;</span>)
</span></span><span style="display:flex;"><span>                        <span style="color:#6ab825;font-weight:bold">for</span> resp <span style="color:#6ab825;font-weight:bold">in</span> r.history:
</span></span><span style="display:flex;"><span>                            logger.info(
</span></span><span style="display:flex;"><span>                                <span style="color:#ed9d13">&#34;Redirected response: </span><span style="color:#ed9d13">%s</span><span style="color:#ed9d13">&#34;</span> 
</span></span><span style="display:flex;"><span>                                % resp.status_code 
</span></span><span style="display:flex;"><span>                                + <span style="color:#ed9d13">&#34; &#34;</span> 
</span></span><span style="display:flex;"><span>                                + resp.url
</span></span><span style="display:flex;"><span>                            )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    logger.info(
</span></span><span style="display:flex;"><span>                            <span style="color:#ed9d13">&#34;Final destination: </span><span style="color:#ed9d13">%s</span><span style="color:#ed9d13">&#34;</span> 
</span></span><span style="display:flex;"><span>                            % r.status_code 
</span></span><span style="display:flex;"><span>                            + <span style="color:#ed9d13">&#34; &#34;</span> 
</span></span><span style="display:flex;"><span>                            + r.url
</span></span><span style="display:flex;"><span>                        )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    r.raise_for_status()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>                    <span style="color:#6ab825;font-weight:bold">if</span> (self.__vote_pointer != self.poll_votes): 
</span></span><span style="display:flex;"><span>                        <span style="color:#999;font-style:italic"># Wait a random number of seconds between 5 &amp; 20</span>
</span></span><span style="display:flex;"><span>                        <span style="color:#999;font-style:italic">#  before starting again - more realistic</span>
</span></span><span style="display:flex;"><span>                        wait_time = random.randint(<span style="color:#3677a9">5</span>, <span style="color:#3677a9">20</span>)
</span></span><span style="display:flex;"><span>                        logger.info(<span style="color:#ed9d13">&#34;Waiting </span><span style="color:#ed9d13">%i</span><span style="color:#ed9d13"> seconds.&#34;</span> % (wait_time))
</span></span><span style="display:flex;"><span>                        time.sleep(wait_time)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># Any issues, log them and get out</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">except</span> <span style="color:#bbb">Exception</span> <span style="color:#6ab825;font-weight:bold">as</span> e:
</span></span><span style="display:flex;"><span>            logger.error(e)
</span></span><span style="display:flex;"><span>            <span style="color:#6ab825;font-weight:bold">raise</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#6ab825;font-weight:bold">def</span> <span style="color:#447fcf">getVotes</span>(self):
</span></span><span style="display:flex;"><span>        getdata = <span style="color:#6ab825;font-weight:bold">True</span>
</span></span><span style="display:flex;"><span>        self.__vote_pointer = <span style="color:#3677a9">0</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic"># No sense in doing anything without a poll id </span>
</span></span><span style="display:flex;"><span>        <span style="color:#999;font-style:italic">#   and an option to vote for</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">if</span> (self.poll_option != <span style="color:#ed9d13">&#34;&#34;</span> <span style="color:#6ab825;font-weight:bold">and</span> self.poll_id != <span style="color:#ed9d13">&#34;&#34;</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#6ab825;font-weight:bold">try</span>:
</span></span><span style="display:flex;"><span>                <span style="color:#999;font-style:italic"># If set to 0, run continuously</span>
</span></span><span style="display:flex;"><span>                <span style="color:#6ab825;font-weight:bold">if</span> (self.poll_votes == <span style="color:#3677a9">0</span>):
</span></span><span style="display:flex;"><span>                    <span style="color:#6ab825;font-weight:bold">while</span> getdata:
</span></span><span style="display:flex;"><span>                        self.__getVote()
</span></span><span style="display:flex;"><span>                <span style="color:#6ab825;font-weight:bold">else</span>: 
</span></span><span style="display:flex;"><span>                    <span style="color:#6ab825;font-weight:bold">for</span> _ <span style="color:#6ab825;font-weight:bold">in</span> <span style="color:#24909d">range</span>(self.poll_votes):
</span></span><span style="display:flex;"><span>                        self.__getVote()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#6ab825;font-weight:bold">except</span> <span style="color:#bbb">Exception</span> <span style="color:#6ab825;font-weight:bold">as</span> e:
</span></span><span style="display:flex;"><span>                logger.error(e)
</span></span><span style="display:flex;"><span>                getdata = <span style="color:#6ab825;font-weight:bold">False</span>
</span></span><span style="display:flex;"><span>        <span style="color:#6ab825;font-weight:bold">else</span>:
</span></span><span style="display:flex;"><span>            logger.info(<span style="color:#ed9d13">&#34;Please set Poll ID &amp; Option.&#34;</span>)
</span></span></code></pre></div>
    </div>
    <div class="post-footer">
      
    </div>
  </article>

    </main>
  </body>
</html>
